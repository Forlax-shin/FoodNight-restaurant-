<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Dashboard Admin - Firebase</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
    
    <!-- Multi-language Configuration -->
    <script>
    // ===== MULTI-LANGUAGE SUPPORT =====
    const translations = {
        en: {
            // Login
            login: "LOGIN",
            signup: "SIGNUP",
            forgot: "FORGOT PASSWORD",
            adminLogin: "Admin Login",
            createAccount: "Create Admin Account",
            resetPassword: "Reset Password",
            email: "Email",
            password: "Password",
            fullName: "Full Name",
            confirmPassword: "Confirm Password",
            minChars: "Password (min. 6 chars)",
            
            // Dashboard
            dashboard: "Dashboard",
            orders: "Orders",
            menu: "Menu",
            payments: "Payments",
            settings: "Settings",
            welcome: "Welcome",
            logout: "Logout",
            
            // Stats
            incomeToday: "TODAY'S INCOME",
            incomeMonth: "MONTHLY INCOME",
            totalOrders: "TOTAL ORDERS",
            pendingPayments: "PENDING PAYMENTS",
            
            // Finance
            financeReport: "FINANCE REPORT",
            daily: "Daily",
            weekly: "Weekly",
            monthly: "Monthly",
            downloadReport: "DOWNLOAD REPORT",
            customRange: "Custom Range",
            
            // Orders
            recentOrders: "10 RECENT ORDERS",
            pendingVerification: "PENDING PAYMENT VERIFICATION",
            allOrders: "ALL ORDERS",
            filter: "Filter",
            reset: "Reset",
            allStatus: "All Status",
            waitingPayment: "Waiting Payment",
            cancelled: "Cancelled",
            time: "Time",
            orderId: "Order ID",
            customer: "Customer",
            total: "Total",
            status: "Status",
            action: "Action",
            proof: "Proof",
            amount: "Amount",
            
            // Menu
            addEditMenu: "ADD/EDIT MENU",
            menuName: "Menu Name",
            price: "Price",
            cost: "Cost (COGS)",
            category: "Category",
            stock: "Stock",
            setDiscount: "SET DISCOUNT",
            noDiscount: "No Discount",
            percentage: "Percentage (%)",
            nominal: "Nominal ($)",
            discountValue: "Discount Value",
            imageLink: "Image Link",
            description: "Description",
            saveMenu: "SAVE MENU",
            blockDate: "BLOCK DATE",
            blockedDates: "Blocked Dates",
            fullyBooked: "Fully Booked",
            holiday: "Holiday",
            maintenance: "Maintenance",
            privateEvent: "Private Event",
            menuList: "MENU LIST",
            searchMenu: "Search menu...",
            
            // Payments
            manageBank: "MANAGE BANK ACCOUNTS",
            bankName: "Bank Name",
            accountName: "Account Holder Name",
            accountNumber: "Account Number",
            addAccount: "ADD ACCOUNT",
            paymentVerification: "PAYMENT VERIFICATION",
            uploadTime: "Upload Time",
            
            // Settings
            storeInfo: "Store Information",
            general: "General",
            tax: "Tax & Fee",
            invoice: "Invoice",
            email: "Email",
            system: "System",
            restaurantName: "Restaurant Name",
            phone: "Phone",
            address: "Address",
            openingTime: "Opening Time (08:00)",
            closingTime: "Closing Time (22:00)",
            website: "Website",
            instagram: "Instagram",
            facebook: "Facebook",
            storeDescription: "Store Description",
            saveStoreInfo: "SAVE STORE INFO",
            otherInfo: "OTHER INFORMATION",
            
            // Tax Settings
            taxSettings: "TAX & SERVICE FEE SETTINGS",
            taxName: "Tax Name",
            taxPercentage: "Tax Percentage (%)",
            serviceFeeName: "Service Fee Name",
            serviceFeePercentage: "Service Fee (%)",
            saveSettings: "SAVE SETTINGS",
            calculationPreview: "Calculation Preview",
            subtotal: "Subtotal",
            total: "Total",
            
            // Invoice
            invoiceTemplate: "INVOICE TEMPLATE",
            invoicePrefix: "Invoice Prefix (GB)",
            invoiceFooter: "Invoice Footer",
            invoiceTerms: "Terms & Conditions",
            logoUrl: "Logo URL",
            primaryColor: "Primary Color",
            saveTemplate: "SAVE TEMPLATE",
            invoicePreview: "INVOICE PREVIEW",
            refreshPreview: "Refresh Preview",
            
            // Email
            emailTemplate: "EMAIL TEMPLATE",
            orderConfirmation: "Order Confirmation",
            paymentConfirmation: "Payment Confirmation",
            welcomeEmail: "Welcome Email",
            emailSubject: "Email Subject",
            emailBody: "Email Content",
            variables: "Variables",
            saveTemplate: "SAVE TEMPLATE",
            testEmail: "TEST EMAIL",
            testEmailPlaceholder: "Email for testing",
            sendTest: "SEND TEST EMAIL",
            manageAdmin: "MANAGE ADMIN",
            addAdmin: "ADD ADMIN",
            
            // System
            backupRestore: "BACKUP & RESTORE",
            backupAll: "BACKUP ALL DATA",
            restoreData: "RESTORE DATA",
            resetSystem: "RESET SYSTEM",
            resetAllData: "RESET ALL DATA",
            systemInfo: "SYSTEM INFORMATION",
            version: "Version",
            totalMenu: "Total Menu Items",
            totalOrder: "Total Orders",
            totalCustomers: "Total Customers",
            dbSize: "Database Size",
            lastBackup: "Last Backup",
            refreshInfo: "REFRESH INFO",
            
            // Modals
            detailOrder: "ORDER DETAILS & INVOICE",
            printInvoice: "Print Invoice",
            sendEmail: "Send Email",
            verifyPayment: "VERIFY PAYMENT",
            acceptPayment: "Accept Payment",
            rejectPayment: "Reject Payment",
            addNewAdmin: "ADD NEW ADMIN",
            adminRole: "Admin Role",
            staff: "Staff",
            save: "SAVE",
            cancel: "Cancel",
            
            // Actions
            view: "View",
            edit: "Edit",
            delete: "Delete",
            approve: "Approve",
            reject: "Reject",
            detail: "Detail",
            verify: "Verify",
            
            // Status
            pending: "Pending",
            paid: "Paid",
            waiting_payment: "Waiting Payment",
            
            // Messages
            loading: "Loading...",
            welcomeBack: "Welcome back",
            loginSuccess: "Login successful",
            loginFailed: "Login failed",
            saveSuccess: "Saved successfully",
            saveFailed: "Save failed",
            deleteConfirm: "Are you sure to delete?",
            deleteSuccess: "Deleted successfully",
            deleteFailed: "Delete failed",
            updateSuccess: "Updated successfully",
            updateFailed: "Update failed",
            noData: "No data available",
            selectDate: "Select date",
            confirmAction: "Confirm action",
            
            // Dates
            monday: "Mon",
            tuesday: "Tue",
            wednesday: "Wed",
            thursday: "Thu",
            friday: "Fri",
            saturday: "Sat",
            sunday: "Sun"
        },
        
        id: {
            // Login
            login: "LOGIN",
            signup: "SIGNUP",
            forgot: "LUPA PASSWORD",
            adminLogin: "Login Admin",
            createAccount: "Buat Akun Admin",
            resetPassword: "Reset Password",
            email: "Email",
            password: "Password",
            fullName: "Nama Lengkap",
            confirmPassword: "Konfirmasi Password",
            minChars: "Password (min. 6 karakter)",
            
            // Dashboard
            dashboard: "Dashboard",
            orders: "Pesanan",
            menu: "Menu",
            payments: "Pembayaran",
            settings: "Pengaturan",
            welcome: "Selamat datang",
            logout: "Keluar",
            
            // Stats
            incomeToday: "PENDAPATAN HARI INI",
            incomeMonth: "PENDAPATAN BULAN INI",
            totalOrders: "TOTAL PESANAN",
            pendingPayments: "MENUNGGU PEMBAYARAN",
            
            // Finance
            financeReport: "LAPORAN KEUANGAN",
            daily: "Harian",
            weekly: "Mingguan",
            monthly: "Bulanan",
            downloadReport: "UNDUH LAPORAN",
            customRange: "Rentang Kustom",
            
            // Orders
            recentOrders: "10 PESANAN TERBARU",
            pendingVerification: "PEMBAYARAN MENUNGGU",
            allOrders: "SEMUA PESANAN",
            filter: "Filter",
            reset: "Reset",
            allStatus: "Semua Status",
            waitingPayment: "Menunggu Pembayaran",
            cancelled: "Dibatalkan",
            time: "Waktu",
            orderId: "ID Pesanan",
            customer: "Pelanggan",
            total: "Total",
            status: "Status",
            action: "Aksi",
            proof: "Bukti",
            amount: "Jumlah",
            
            // Menu
            addEditMenu: "TAMBAH/EDIT MENU",
            menuName: "Nama Menu",
            price: "Harga",
            cost: "Modal (COGS)",
            category: "Kategori",
            stock: "Stok",
            setDiscount: "SET DISKON",
            noDiscount: "Tidak Ada Diskon",
            percentage: "Persentase (%)",
            nominal: "Nominal (Rp)",
            discountValue: "Nilai Diskon",
            imageLink: "Link Gambar",
            description: "Deskripsi",
            saveMenu: "SIMPAN MENU",
            blockDate: "BLOKIR TANGGAL",
            blockedDates: "Tanggal Terblokir",
            fullyBooked: "Full Booked",
            holiday: "Libur",
            maintenance: "Maintenance",
            privateEvent: "Private Event",
            menuList: "DAFTAR MENU",
            searchMenu: "Cari menu...",
            
            // Payments
            manageBank: "KELOLA REKENING BANK",
            bankName: "Nama Bank",
            accountName: "Nama Pemilik Rekening",
            accountNumber: "Nomor Rekening",
            addAccount: "TAMBAH REKENING",
            paymentVerification: "VERIFIKASI PEMBAYARAN",
            uploadTime: "Waktu Upload",
            
            // Settings
            storeInfo: "INFORMASI TOKO",
            general: "General",
            tax: "Tax & Fee",
            invoice: "Invoice",
            email: "Email",
            system: "System",
            restaurantName: "Nama Restoran",
            phone: "Telepon",
            address: "Alamat",
            openingTime: "Jam Buka (08:00)",
            closingTime: "Jam Tutup (22:00)",
            website: "Website",
            instagram: "Instagram",
            facebook: "Facebook",
            storeDescription: "Deskripsi Toko",
            saveStoreInfo: "SIMPAN INFORMASI TOKO",
            otherInfo: "INFORMASI LAINNYA",
            
            // Tax Settings
            taxSettings: "PENGATURAN TAX & SERVICE FEE",
            taxName: "Nama Tax",
            taxPercentage: "Persentase Tax (%)",
            serviceFeeName: "Nama Service Fee",
            serviceFeePercentage: "Service Fee (%)",
            saveSettings: "SIMPAN PENGATURAN",
            calculationPreview: "Preview Kalkulasi",
            subtotal: "Subtotal",
            total: "Total",
            
            // Invoice
            invoiceTemplate: "TEMPLATE INVOICE",
            invoicePrefix: "Prefix Invoice (GB)",
            invoiceFooter: "Footer Invoice",
            invoiceTerms: "Syarat & Ketentuan",
            logoUrl: "Logo URL",
            primaryColor: "Warna Utama",
            saveTemplate: "SIMPAN TEMPLATE",
            invoicePreview: "PREVIEW INVOICE",
            refreshPreview: "Refresh Preview",
            
            // Email
            emailTemplate: "EMAIL TEMPLATE",
            orderConfirmation: "Konfirmasi Pesanan",
            paymentConfirmation: "Konfirmasi Pembayaran",
            welcomeEmail: "Email Selamat Datang",
            emailSubject: "Subject Email",
            emailBody: "Isi Email",
            variables: "Variables",
            saveTemplate: "SIMPAN TEMPLATE",
            testEmail: "TEST EMAIL",
            testEmailPlaceholder: "Email untuk test",
            sendTest: "KIRIM TEST EMAIL",
            manageAdmin: "KELOLA ADMIN",
            addAdmin: "TAMBAH ADMIN",
            
            // System
            backupRestore: "BACKUP & RESTORE",
            backupAll: "BACKUP SEMUA DATA",
            restoreData: "RESTORE DATA",
            resetSystem: "RESET SYSTEM",
            resetAllData: "RESET SEMUA DATA",
            systemInfo: "SYSTEM INFORMATION",
            version: "Versi",
            totalMenu: "Total Menu Items",
            totalOrder: "Total Pesanan",
            totalCustomers: "Total Pelanggan",
            dbSize: "Ukuran Database",
            lastBackup: "Backup Terakhir",
            refreshInfo: "REFRESH INFO",
            
            // Modals
            detailOrder: "DETAIL PESANAN & INVOICE",
            printInvoice: "Print Invoice",
            sendEmail: "Kirim Email",
            verifyPayment: "VERIFIKASI BUKTI PEMBAYARAN",
            acceptPayment: "Terima Pembayaran",
            rejectPayment: "Tolak Pembayaran",
            addNewAdmin: "TAMBAH ADMIN BARU",
            adminRole: "Peran Admin",
            staff: "Staff",
            save: "SIMPAN",
            cancel: "BATAL",
            
            // Actions
            view: "Lihat",
            edit: "Edit",
            delete: "Hapus",
            approve: "Setujui",
            reject: "Tolak",
            detail: "Detail",
            verify: "Verifikasi",
            
            // Status
            pending: "Pending",
            paid: "Lunas",
            waiting_payment: "Menunggu Bayar",
            
            // Messages
            loading: "Memuat...",
            welcomeBack: "Selamat datang kembali",
            loginSuccess: "Login berhasil",
            loginFailed: "Login gagal",
            saveSuccess: "Berhasil disimpan",
            saveFailed: "Gagal menyimpan",
            deleteConfirm: "Yakin ingin menghapus?",
            deleteSuccess: "Berhasil dihapus",
            deleteFailed: "Gagal menghapus",
            updateSuccess: "Berhasil diperbarui",
            updateFailed: "Gagal memperbarui",
            noData: "Tidak ada data",
            selectDate: "Pilih tanggal",
            confirmAction: "Konfirmasi aksi",
            
            // Dates
            monday: "Sen",
            tuesday: "Sel",
            wednesday: "Rab",
            thursday: "Kam",
            friday: "Jum",
            saturday: "Sab",
            sunday: "Min"
        },
        
        es: {
            // Login
            login: "INICIAR SESIÓN",
            signup: "REGISTRARSE",
            forgot: "¿OLVIDÓ CONTRASEÑA?",
            adminLogin: "Inicio de Sesión Admin",
            createAccount: "Crear Cuenta de Admin",
            resetPassword: "Restablecer Contraseña",
            email: "Correo Electrónico",
            password: "Contraseña",
            fullName: "Nombre Completo",
            confirmPassword: "Confirmar Contraseña",
            minChars: "Contraseña (mín. 6 caracteres)",
            
            // Dashboard
            dashboard: "Panel",
            orders: "Pedidos",
            menu: "Menú",
            payments: "Pagos",
            settings: "Configuración",
            welcome: "Bienvenido",
            logout: "Cerrar Sesión",
            
            // Stats
            incomeToday: "INGRESO HOY",
            incomeMonth: "INGRESO MENSUAL",
            totalOrders: "TOTAL PEDIDOS",
            pendingPayments: "PAGOS PENDIENTES",
            
            // Finance
            financeReport: "INFORME FINANCIERO",
            daily: "Diario",
            weekly: "Semanal",
            monthly: "Mensual",
            downloadReport: "DESCARGAR INFORME",
            customRange: "Rango Personalizado",
            
            // Orders
            recentOrders: "10 PEDIDOS RECIENTES",
            pendingVerification: "VERIFICACIÓN DE PAGO PENDIENTE",
            allOrders: "TODOS LOS PEDIDOS",
            filter: "Filtrar",
            reset: "Restablecer",
            allStatus: "Todos los Estados",
            waitingPayment: "Esperando Pago",
            cancelled: "Cancelado",
            time: "Tiempo",
            orderId: "ID Pedido",
            customer: "Cliente",
            total: "Total",
            status: "Estado",
            action: "Acción",
            proof: "Comprobante",
            amount: "Monto",
            
            // Menu
            addEditMenu: "AGREGAR/EDITAR MENÚ",
            menuName: "Nombre del Menú",
            price: "Precio",
            cost: "Costo (COGS)",
            category: "Categoría",
            stock: "Inventario",
            setDiscount: "ESTABLECER DESCUENTO",
            noDiscount: "Sin Descuento",
            percentage: "Porcentaje (%)",
            nominal: "Nominal ($)",
            discountValue: "Valor de Descuento",
            imageLink: "Enlace de Imagen",
            description: "Descripción",
            saveMenu: "GUARDAR MENÚ",
            blockDate: "BLOQUEAR FECHA",
            blockedDates: "Fechas Bloqueadas",
            fullyBooked: "Completo",
            holiday: "Feriado",
            maintenance: "Mantenimiento",
            privateEvent: "Evento Privado",
            menuList: "LISTA DE MENÚ",
            searchMenu: "Buscar menú...",
            
            // Payments
            manageBank: "GESTIONAR CUENTAS BANCARIAS",
            bankName: "Nombre del Banco",
            accountName: "Nombre del Titular",
            accountNumber: "Número de Cuenta",
            addAccount: "AGREGAR CUENTA",
            paymentVerification: "VERIFICACIÓN DE PAGO",
            uploadTime: "Hora de Subida",
            
            // Settings
            storeInfo: "INFORMACIÓN DE LA TIENDA",
            general: "General",
            tax: "Impuestos & Tarifas",
            invoice: "Factura",
            email: "Correo",
            system: "Sistema",
            restaurantName: "Nombre del Restaurante",
            phone: "Teléfono",
            address: "Dirección",
            openingTime: "Hora Apertura (08:00)",
            closingTime: "Hora Cierre (22:00)",
            website: "Sitio Web",
            instagram: "Instagram",
            facebook: "Facebook",
            storeDescription: "Descripción de la Tienda",
            saveStoreInfo: "GUARDAR INFORMACIÓN",
            otherInfo: "OTRA INFORMACIÓN",
            
            // Tax Settings
            taxSettings: "CONFIGURACIÓN DE IMPUESTOS Y TARIFAS",
            taxName: "Nombre del Impuesto",
            taxPercentage: "Porcentaje de Impuesto (%)",
            serviceFeeName: "Nombre de Tarifa de Servicio",
            serviceFeePercentage: "Tarifa de Servicio (%)",
            saveSettings: "GUARDAR CONFIGURACIÓN",
            calculationPreview: "Vista Previa de Cálculo",
            subtotal: "Subtotal",
            total: "Total",
            
            // Invoice
            invoiceTemplate: "PLANTILLA DE FACTURA",
            invoicePrefix: "Prefijo Factura (GB)",
            invoiceFooter: "Pie de Factura",
            invoiceTerms: "Términos y Condiciones",
            logoUrl: "URL del Logo",
            primaryColor: "Color Principal",
            saveTemplate: "GUARDAR PLANTILLA",
            invoicePreview: "VISTA PREVIA FACTURA",
            refreshPreview: "Actualizar Vista Previa",
            
            // Email
            emailTemplate: "PLANTILLA DE CORREO",
            orderConfirmation: "Confirmación de Pedido",
            paymentConfirmation: "Confirmación de Pago",
            welcomeEmail: "Correo de Bienvenida",
            emailSubject: "Asunto del Correo",
            emailBody: "Contenido del Correo",
            variables: "Variables",
            saveTemplate: "GUARDAR PLANTILLA",
            testEmail: "CORREO DE PRUEBA",
            testEmailPlaceholder: "Correo para prueba",
            sendTest: "ENVIAR CORREO PRUEBA",
            manageAdmin: "GESTIONAR ADMIN",
            addAdmin: "AGREGAR ADMIN",
            
            // System
            backupRestore: "RESPALDO & RESTAURAR",
            backupAll: "RESPALDAR TODOS LOS DATOS",
            restoreData: "RESTAURAR DATOS",
            resetSystem: "REINICIAR SISTEMA",
            resetAllData: "REINICIAR TODOS LOS DATOS",
            systemInfo: "INFORMACIÓN DEL SISTEMA",
            version: "Versión",
            totalMenu: "Total de Elementos en Menú",
            totalOrder: "Total de Pedidos",
            totalCustomers: "Total de Clientes",
            dbSize: "Tamaño de Base de Datos",
            lastBackup: "Último Respaldo",
            refreshInfo: "ACTUALIZAR INFORMACIÓN",
            
            // Modals
            detailOrder: "DETALLES DEL PEDIDO & FACTURA",
            printInvoice: "Imprimir Factura",
            sendEmail: "Enviar Correo",
            verifyPayment: "VERIFICAR COMPROBANTE DE PAGO",
            acceptPayment: "Aceptar Pago",
            rejectPayment: "Rechazar Pago",
            addNewAdmin: "AGREGAR NUEVO ADMIN",
            adminRole: "Rol de Admin",
            staff: "Personal",
            save: "GUARDAR",
            cancel: "CANCELAR",
            
            // Actions
            view: "Ver",
            edit: "Editar",
            delete: "Eliminar",
            approve: "Aprobar",
            reject: "Rechazar",
            detail: "Detalle",
            verify: "Verificar",
            
            // Status
            pending: "Pendiente",
            paid: "Pagado",
            waiting_payment: "Esperando Pago",
            
            // Messages
            loading: "Cargando...",
            welcomeBack: "Bienvenido de nuevo",
            loginSuccess: "Inicio de sesión exitoso",
            loginFailed: "Inicio de sesión fallido",
            saveSuccess: "Guardado exitosamente",
            saveFailed: "Error al guardar",
            deleteConfirm: "¿Seguro que desea eliminar?",
            deleteSuccess: "Eliminado exitosamente",
            deleteFailed: "Error al eliminar",
            updateSuccess: "Actualizado exitosamente",
            updateFailed: "Error al actualizar",
            noData: "No hay datos disponibles",
            selectDate: "Seleccionar fecha",
            confirmAction: "Confirmar acción",
            
            // Dates
            monday: "Lun",
            tuesday: "Mar",
            wednesday: "Mié",
            thursday: "Jue",
            friday: "Vie",
            saturday: "Sáb",
            sunday: "Dom"
        },
        
        ar: {
            // Login
            login: "تسجيل الدخول",
            signup: "التسجيل",
            forgot: "نسيت كلمة المرور",
            adminLogin: "تسجيل دخول المشرف",
            createAccount: "إنشاء حساب مشرف",
            resetPassword: "إعادة تعيين كلمة المرور",
            email: "البريد الإلكتروني",
            password: "كلمة المرور",
            fullName: "الاسم الكامل",
            confirmPassword: "تأكيد كلمة المرور",
            minChars: "كلمة المرور (6 أحرف على الأقل)",
            
            // Dashboard
            dashboard: "لوحة التحكم",
            orders: "الطلبات",
            menu: "القائمة",
            payments: "المدفوعات",
            settings: "الإعدادات",
            welcome: "مرحباً",
            logout: "تسجيل الخروج",
            
            // Stats
            incomeToday: "الدخل اليوم",
            incomeMonth: "الدخل الشهري",
            totalOrders: "إجمالي الطلبات",
            pendingPayments: "المدفوعات المعلقة",
            
            // Finance
            financeReport: "التقرير المالي",
            daily: "يومي",
            weekly: "أسبوعي",
            monthly: "شهري",
            downloadReport: "تحميل التقرير",
            customRange: "نطاق مخصص",
            
            // Orders
            recentOrders: "10 طلبات حديثة",
            pendingVerification: "التحقق من الدفع المعلق",
            allOrders: "جميع الطلبات",
            filter: "تصفية",
            reset: "إعادة تعيين",
            allStatus: "جميع الحالات",
            waitingPayment: "بانتظار الدفع",
            cancelled: "ملغي",
            time: "الوقت",
            orderId: "رقم الطلب",
            customer: "العميل",
            total: "الإجمالي",
            status: "الحالة",
            action: "الإجراء",
            proof: "إثبات",
            amount: "المبلغ",
            
            // Menu
            addEditMenu: "إضافة/تحرير القائمة",
            menuName: "اسم القائمة",
            price: "السعر",
            cost: "التكلفة (COGS)",
            category: "الفئة",
            stock: "المخزون",
            setDiscount: "تعيين الخصم",
            noDiscount: "لا يوجد خصم",
            percentage: "نسبة مئوية (%)",
            nominal: "مبلغ (ريال)",
            discountValue: "قيمة الخصم",
            imageLink: "رابط الصورة",
            description: "الوصف",
            saveMenu: "حفظ القائمة",
            blockDate: "حظر التاريخ",
            blockedDates: "التواريخ المحظورة",
            fullyBooked: "مكتمل الحجز",
            holiday: "عطلة",
            maintenance: "صيانة",
            privateEvent: "حدث خاص",
            menuList: "قائمة القوائم",
            searchMenu: "ابحث في القائمة...",
            
            // Payments
            manageBank: "إدارة الحسابات البنكية",
            bankName: "اسم البنك",
            accountName: "اسم صاحب الحساب",
            accountNumber: "رقم الحساب",
            addAccount: "إضافة حساب",
            paymentVerification: "التحقق من الدفع",
            uploadTime: "وقت الرفع",
            
            // Settings
            storeInfo: "معلومات المتجر",
            general: "عام",
            tax: "الضرائب والرسوم",
            invoice: "الفواتير",
            email: "البريد",
            system: "النظام",
            restaurantName: "اسم المطعم",
            phone: "الهاتف",
            address: "العنوان",
            openingTime: "وقت الفتح (08:00)",
            closingTime: "وقت الإغلاق (22:00)",
            website: "الموقع الإلكتروني",
            instagram: "إنستغرام",
            facebook: "فيسبوك",
            storeDescription: "وصف المتجر",
            saveStoreInfo: "حفظ معلومات المتجر",
            otherInfo: "معلومات أخرى",
            
            // Tax Settings
            taxSettings: "إعدادات الضرائب والرسوم",
            taxName: "اسم الضريبة",
            taxPercentage: "نسبة الضريبة (%)",
            serviceFeeName: "اسم رسوم الخدمة",
            serviceFeePercentage: "رسوم الخدمة (%)",
            saveSettings: "حفظ الإعدادات",
            calculationPreview: "معاينة الحساب",
            subtotal: "المجموع الفرعي",
            total: "الإجمالي",
            
            // Invoice
            invoiceTemplate: "قالب الفاتورة",
            invoicePrefix: "بادئة الفاتورة (GB)",
            invoiceFooter: "تذييل الفاتورة",
            invoiceTerms: "الشروط والأحكام",
            logoUrl: "رابط الشعار",
            primaryColor: "اللون الأساسي",
            saveTemplate: "حفظ القالب",
            invoicePreview: "معاينة الفاتورة",
            refreshPreview: "تحديث المعاينة",
            
            // Email
            emailTemplate: "قالب البريد الإلكتروني",
            orderConfirmation: "تأكيد الطلب",
            paymentConfirmation: "تأكيد الدفع",
            welcomeEmail: "بريد الترحيب",
            emailSubject: "موضوع البريد",
            emailBody: "محتوى البريد",
            variables: "المتغيرات",
            saveTemplate: "حفظ القالب",
            testEmail: "اختبار البريد",
            testEmailPlaceholder: "البريد للاختبار",
            sendTest: "إرسال بريد اختبار",
            manageAdmin: "إدارة المشرفين",
            addAdmin: "إضافة مشرف",
            
            // System
            backupRestore: "النسخ الاحتياطي والاستعادة",
            backupAll: "نسخ جميع البيانات",
            restoreData: "استعادة البيانات",
            resetSystem: "إعادة تعيين النظام",
            resetAllData: "إعادة تعيين جميع البيانات",
            systemInfo: "معلومات النظام",
            version: "الإصدار",
            totalMenu: "إجمالي عناصر القائمة",
            totalOrder: "إجمالي الطلبات",
            totalCustomers: "إجمالي العملاء",
            dbSize: "حجم قاعدة البيانات",
            lastBackup: "آخر نسخ احتياطي",
            refreshInfo: "تحديث المعلومات",
            
            // Modals
            detailOrder: "تفاصيل الطلب والفاتورة",
            printInvoice: "طباعة الفاتورة",
            sendEmail: "إرسال بريد",
            verifyPayment: "التحقق من إثبات الدفع",
            acceptPayment: "قبول الدفع",
            rejectPayment: "رفض الدفع",
            addNewAdmin: "إضافة مشرف جديد",
            adminRole: "دور المشرف",
            staff: "موظف",
            save: "حفظ",
            cancel: "إلغاء",
            
            // Actions
            view: "عرض",
            edit: "تحرير",
            delete: "حذف",
            approve: "موافقة",
            reject: "رفض",
            detail: "تفاصيل",
            verify: "التحقق",
            
            // Status
            pending: "معلق",
            paid: "مدفوع",
            waiting_payment: "بانتظار الدفع",
            
            // Messages
            loading: "جاري التحميل...",
            welcomeBack: "أهلاً بعودتك",
            loginSuccess: "تم تسجيل الدخول بنجاح",
            loginFailed: "فشل تسجيل الدخول",
            saveSuccess: "تم الحفظ بنجاح",
            saveFailed: "فشل الحفظ",
            deleteConfirm: "هل أنت متأكد من الحذف؟",
            deleteSuccess: "تم الحذف بنجاح",
            deleteFailed: "فشل الحذف",
            updateSuccess: "تم التحديث بنجاح",
            updateFailed: "فشل التحديث",
            noData: "لا توجد بيانات",
            selectDate: "اختر التاريخ",
            confirmAction: "تأكيد الإجراء",
            
            // Dates
            monday: "الاثنين",
            tuesday: "الثلاثاء",
            wednesday: "الأربعاء",
            thursday: "الخميس",
            friday: "الجمعة",
            saturday: "السبت",
            sunday: "الأحد"
        },
        
        zh: {
            // Login
            login: "登录",
            signup: "注册",
            forgot: "忘记密码",
            adminLogin: "管理员登录",
            createAccount: "创建管理员账户",
            resetPassword: "重置密码",
            email: "电子邮件",
            password: "密码",
            fullName: "全名",
            confirmPassword: "确认密码",
            minChars: "密码 (至少6个字符)",
            
            // Dashboard
            dashboard: "仪表板",
            orders: "订单",
            menu: "菜单",
            payments: "支付",
            settings: "设置",
            welcome: "欢迎",
            logout: "退出登录",
            
            // Stats
            incomeToday: "今日收入",
            incomeMonth: "本月收入",
            totalOrders: "总订单",
            pendingPayments: "待处理付款",
            
            // Finance
            financeReport: "财务报告",
            daily: "每日",
            weekly: "每周",
            monthly: "每月",
            downloadReport: "下载报告",
            customRange: "自定义范围",
            
            // Orders
            recentOrders: "10个最近订单",
            pendingVerification: "待验证付款",
            allOrders: "所有订单",
            filter: "筛选",
            reset: "重置",
            allStatus: "所有状态",
            waitingPayment: "等待付款",
            cancelled: "已取消",
            time: "时间",
            orderId: "订单号",
            customer: "客户",
            total: "总计",
            status: "状态",
            action: "操作",
            proof: "证明",
            amount: "金额",
            
            // Menu
            addEditMenu: "添加/编辑菜单",
            menuName: "菜单名称",
            price: "价格",
            cost: "成本 (COGS)",
            category: "类别",
            stock: "库存",
            setDiscount: "设置折扣",
            noDiscount: "无折扣",
            percentage: "百分比 (%)",
            nominal: "金额 (¥)",
            discountValue: "折扣值",
            imageLink: "图片链接",
            description: "描述",
            saveMenu: "保存菜单",
            blockDate: "封锁日期",
            blockedDates: "封锁的日期",
            fullyBooked: "已订满",
            holiday: "假日",
            maintenance: "维护",
            privateEvent: "私人活动",
            menuList: "菜单列表",
            searchMenu: "搜索菜单...",
            
            // Payments
            manageBank: "管理银行账户",
            bankName: "银行名称",
            accountName: "账户持有人姓名",
            accountNumber: "账户号码",
            addAccount: "添加账户",
            paymentVerification: "付款验证",
            uploadTime: "上传时间",
            
            // Settings
            storeInfo: "店铺信息",
            general: "常规",
            tax: "税费",
            invoice: "发票",
            email: "电子邮件",
            system: "系统",
            restaurantName: "餐厅名称",
            phone: "电话",
            address: "地址",
            openingTime: "营业时间 (08:00)",
            closingTime: "关闭时间 (22:00)",
            website: "网站",
            instagram: "Instagram",
            facebook: "Facebook",
            storeDescription: "店铺描述",
            saveStoreInfo: "保存店铺信息",
            otherInfo: "其他信息",
            
            // Tax Settings
            taxSettings: "税费设置",
            taxName: "税名称",
            taxPercentage: "税率 (%)",
            serviceFeeName: "服务费名称",
            serviceFeePercentage: "服务费 (%)",
            saveSettings: "保存设置",
            calculationPreview: "计算预览",
            subtotal: "小计",
            total: "总计",
            
            // Invoice
            invoiceTemplate: "发票模板",
            invoicePrefix: "发票前缀 (GB)",
            invoiceFooter: "发票页脚",
            invoiceTerms: "条款与条件",
            logoUrl: "Logo URL",
            primaryColor: "主颜色",
            saveTemplate: "保存模板",
            invoicePreview: "发票预览",
            refreshPreview: "刷新预览",
            
            // Email
            emailTemplate: "电子邮件模板",
            orderConfirmation: "订单确认",
            paymentConfirmation: "付款确认",
            welcomeEmail: "欢迎邮件",
            emailSubject: "邮件主题",
            emailBody: "邮件内容",
            variables: "变量",
            saveTemplate: "保存模板",
            testEmail: "测试邮件",
            testEmailPlaceholder: "测试邮箱",
            sendTest: "发送测试邮件",
            manageAdmin: "管理管理员",
            addAdmin: "添加管理员",
            
            // System
            backupRestore: "备份与恢复",
            backupAll: "备份所有数据",
            restoreData: "恢复数据",
            resetSystem: "重置系统",
            resetAllData: "重置所有数据",
            systemInfo: "系统信息",
            version: "版本",
            totalMenu: "总菜单项",
            totalOrder: "总订单",
            totalCustomers: "总客户",
            dbSize: "数据库大小",
            lastBackup: "最后备份",
            refreshInfo: "刷新信息",
            
            // Modals
            detailOrder: "订单详情和发票",
            printInvoice: "打印发票",
            sendEmail: "发送邮件",
            verifyPayment: "验证付款证明",
            acceptPayment: "接受付款",
            rejectPayment: "拒绝付款",
            addNewAdmin: "添加新管理员",
            adminRole: "管理员角色",
            staff: "员工",
            save: "保存",
            cancel: "取消",
            
            // Actions
            view: "查看",
            edit: "编辑",
            delete: "删除",
            approve: "批准",
            reject: "拒绝",
            detail: "详情",
            verify: "验证",
            
            // Status
            pending: "待处理",
            paid: "已支付",
            waiting_payment: "等待付款",
            
            // Messages
            loading: "加载中...",
            welcomeBack: "欢迎回来",
            loginSuccess: "登录成功",
            loginFailed: "登录失败",
            saveSuccess: "保存成功",
            saveFailed: "保存失败",
            deleteConfirm: "确定要删除吗？",
            deleteSuccess: "删除成功",
            deleteFailed: "删除失败",
            updateSuccess: "更新成功",
            updateFailed: "更新失败",
            noData: "无数据",
            selectDate: "选择日期",
            confirmAction: "确认操作",
            
            // Dates
            monday: "周一",
            tuesday: "周二",
            wednesday: "周三",
            thursday: "周四",
            friday: "周五",
            saturday: "周六",
            sunday: "周日"
        }
    };

    // Language detection
    let currentLang = 'id'; // Default
    
    function detectLanguage() {
        const browserLang = navigator.language || navigator.userLanguage;
        
        if (browserLang.startsWith('en')) {
            return 'en';
        } else if (browserLang.startsWith('es')) {
            return 'es';
        } else if (browserLang.startsWith('ar')) {
            return 'ar';
        } else if (browserLang.startsWith('zh')) {
            return 'zh';
        } else {
            return 'id'; // Default to Indonesian
        }
    }
    
    function setLanguage(lang) {
        currentLang = lang;
        localStorage.setItem('admin_language', lang);
        updateUIText();
    }
    
    function getTranslation(key) {
        return translations[currentLang]?.[key] || translations['en'][key] || key;
    }
    
    function updateUIText() {
        // Update all elements with data-translate attribute
        document.querySelectorAll('[data-translate]').forEach(element => {
            const key = element.getAttribute('data-translate');
            const translation = getTranslation(key);
            
            if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                element.placeholder = translation;
            } else {
                element.textContent = translation;
            }
        });
        
        // Update title attributes
        document.querySelectorAll('[title]').forEach(element => {
            const key = element.getAttribute('title');
            if (translations[currentLang]?.[key]) {
                element.setAttribute('title', translations[currentLang][key]);
            }
        });
    }
    
    // Initialize language on page load
    window.addEventListener('DOMContentLoaded', () => {
        const savedLang = localStorage.getItem('admin_language');
        if (savedLang && translations[savedLang]) {
            currentLang = savedLang;
        } else {
            currentLang = detectLanguage();
        }
        
        // Add language selector to header
        const header = document.querySelector('.admin-header');
        if (header) {
            const langSelector = document.createElement('div');
            langSelector.innerHTML = `
                <select id="languageSelect" onchange="setLanguage(this.value)" 
                        style="background: var(--dark); color: var(--white); border: 1px solid var(--gray); border-radius: 5px; padding: 5px 10px;">
                    <option value="id" ${currentLang === 'id' ? 'selected' : ''}>ID</option>
                    <option value="en" ${currentLang === 'en' ? 'selected' : ''}>EN</option>
                    <option value="es" ${currentLang === 'es' ? 'selected' : ''}>ES</option>
                    <option value="ar" ${currentLang === 'ar' ? 'selected' : ''}>AR</option>
                    <option value="zh" ${currentLang === 'zh' ? 'selected' : ''}>ZH</option>
                </select>
            `;
            header.querySelector('div[style*="display: flex; align-items: center"]').appendChild(langSelector);
        }
        
        updateUIText();
    });
    </script>

    <style>
        :root {
            --gold: #d4af37; --gold-light: #e6c158; --dark: #0f0f0f; --dark-light: #1a1a1a;
            --gray: #333; --gray-light: #444; --white: #fff; --text-light: #e0e0e0; --text-gray: #888;
            --success: #28a745; --warning: #ffc107; --danger: #dc3545; --info: #17a2b8;
        }
        body { 
            padding: 20px; 
            background: var(--dark); 
            font-family: 'Montserrat', sans-serif; 
            margin: 0;
            min-height: 100vh;
        }
        .admin-container { max-width: 1400px; margin: 0 auto; }
        
        /* Login Area */
        #loginArea { 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            min-height: 100vh; 
            background: linear-gradient(135deg, var(--dark) 0%, #000 100%);
        }
        .login-card { 
            background: var(--dark-light); 
            padding: 40px; 
            border-radius: 20px; 
            width: 100%; 
            max-width: 450px; 
            border: 1px solid var(--gray);
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
        .login-tabs { 
            display: flex; 
            margin-bottom: 30px;
            border-bottom: 1px solid var(--gray);
        }
        .login-tab { 
            flex: 1; 
            padding: 15px; 
            background: none; 
            border: none; 
            color: var(--text-gray); 
            cursor: pointer; 
            font-weight: 600;
            transition: all 0.3s;
            position: relative;
        }
        .login-tab:hover { color: var(--gold); }
        .login-tab.active { color: var(--gold); }
        .login-tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gold);
        }
        .login-form { display: none; animation: fadeIn 0.5s; }
        .login-form.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        .input-pro { 
            width: 100%; 
            padding: 14px; 
            background: var(--dark); 
            border: 2px solid var(--gray); 
            color: var(--white); 
            border-radius: 10px; 
            font-family: 'Montserrat', sans-serif;
            margin-bottom: 15px;
            box-sizing: border-box;
        }
        .input-pro:focus { 
            outline: none; 
            border-color: var(--gold); 
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.2);
        }
        
        .btn-login { 
            width: 100%; 
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-light) 100%);
            border: none; 
            padding: 16px; 
            color: var(--dark); 
            border-radius: 10px; 
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Montserrat', sans-serif;
        }
        .btn-login:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(212, 175, 55, 0.4);
        }
        
        /* Admin Content */
        #adminContent { display: none; }
        .admin-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 30px; 
            padding: 20px; 
            background: var(--dark-light); 
            border-radius: 15px; 
            border: 1px solid var(--gray);
        }
        .admin-title { 
            color: var(--gold); 
            font-size: 1.8rem; 
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        /* Admin Tabs */
        .admin-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            border-bottom: 1px solid var(--gray);
            padding-bottom: 10px;
        }
        .admin-tab {
            padding: 12px 25px;
            background: var(--dark);
            border: 1px solid var(--gray);
            color: var(--text-gray);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
        }
        .admin-tab:hover {
            border-color: var(--gold);
            color: var(--gold);
        }
        .admin-tab.active {
            background: var(--gold);
            color: var(--dark);
            border-color: var(--gold);
        }
        .admin-tab-content {
            display: block;
        }
        
        /* Stats */
        .stats-container { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); 
            gap: 20px; 
            margin-bottom: 30px; 
        }
        .stat-card { 
            background: var(--dark-light); 
            padding: 25px; 
            border-radius: 15px; 
            border: 1px solid var(--gray); 
            transition: all 0.3s;
        }
        .stat-card:hover { transform: translateY(-5px); border-color: var(--gold); }
        .stat-card.gold { background: var(--gold); color: var(--dark); }
        .stat-value { font-size: 2.2rem; font-weight: 900; color: var(--white); margin-bottom: 5px; }
        .stat-card.gold .stat-value { color: var(--dark); }
        
        /* Layout */
        .admin-grid { 
            display: grid; 
            grid-template-columns: 320px 1fr; 
            gap: 30px; 
            margin-top: 30px; 
        }
        @media (max-width: 1200px) { .admin-grid { grid-template-columns: 1fr; } }
        .card { 
            background: var(--dark-light); 
            padding: 25px; 
            border-radius: 15px; 
            border: 1px solid var(--gray); 
            margin-bottom: 20px; 
        }
        
        /* Tables */
        .table-container { overflow-x: auto; }
        .table-pro { width: 100%; border-collapse: collapse; min-width: 800px; }
        .table-pro th { 
            padding: 15px; 
            text-align: left; 
            color: var(--gold); 
            border-bottom: 2px solid var(--gray); 
            font-weight: 700;
        }
        .table-pro td { 
            padding: 15px; 
            border-bottom: 1px solid var(--gray); 
            color: var(--text-light); 
            vertical-align: middle;
        }
        .table-pro tbody tr:hover { background: rgba(212, 175, 55, 0.05); }
        
        .status-badge { 
            padding: 5px 12px; 
            border-radius: 20px; 
            font-size: 0.8rem; 
            font-weight: 700; 
            display: inline-block;
        }
        .status-pending { background: rgba(255, 193, 7, 0.2); color: var(--warning); }
        .status-success { background: rgba(40, 167, 69, 0.2); color: var(--success); }
        .status-canceled { background: rgba(220, 53, 69, 0.2); color: var(--danger); }
        .status-waiting { background: rgba(0, 123, 255, 0.2); color: #007bff; }
        
        /* Action Buttons */
        .action-buttons { display: flex; gap: 8px; flex-wrap: wrap; }
        .action-btn { 
            padding: 6px 12px; 
            border: none; 
            border-radius: 6px; 
            cursor: pointer; 
            font-size: 0.8rem; 
            font-weight: 600;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            min-width: 70px;
        }
        .btn-view { background: rgba(23, 162, 184, 0.2); color: var(--info); }
        .btn-view:hover { background: rgba(23, 162, 184, 0.3); }
        .btn-edit { background: rgba(255, 193, 7, 0.2); color: var(--warning); }
        .btn-edit:hover { background: rgba(255, 193, 7, 0.3); }
        .btn-delete { background: rgba(220, 53, 69, 0.2); color: var(--danger); }
        .btn-delete:hover { background: rgba(220, 53, 69, 0.3); }
        .btn-success { background: rgba(40, 167, 69, 0.2); color: var(--success); }
        .btn-success:hover { background: rgba(40, 167, 69, 0.3); }
        .btn-gold { background: rgba(212, 175, 55, 0.2); color: var(--gold); }
        .btn-gold:hover { background: rgba(212, 175, 55, 0.3); }
        .btn-upload { background: rgba(111, 66, 193, 0.2); color: #6f42c1; }
        .btn-upload:hover { background: rgba(111, 66, 193, 0.3); }
        
        /* Charts */
        .chart-container { 
            height: 350px; 
            margin: 20px 0; 
            background: var(--dark); 
            padding: 20px; 
            border-radius: 10px; 
            border: 1px solid var(--gray);
            position: relative;
        }
        .chart-controls { 
            display: flex; 
            gap: 10px; 
            margin-bottom: 15px; 
        }
        .chart-btn { 
            padding: 8px 15px; 
            background: var(--dark); 
            border: 1px solid var(--gray); 
            color: var(--text-gray); 
            border-radius: 6px; 
            cursor: pointer; 
            transition: all 0.2s;
        }
        .chart-btn:hover { color: var(--gold); border-color: var(--gold); }
        .chart-btn.active { background: var(--gold); color: var(--dark); border-color: var(--gold); }
        
        /* Menu Grid */
        .menu-grid-admin { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); 
            gap: 20px; 
            margin-top: 15px; 
        }
        .menu-item-card { 
            background: var(--dark); 
            border-radius: 12px; 
            border: 1px solid var(--gray); 
            overflow: hidden; 
            transition: all 0.3s;
        }
        .menu-item-card:hover { 
            transform: translateY(-5px); 
            border-color: var(--gold);
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }
        .menu-item-image { width: 100%; height: 160px; overflow: hidden; }
        .menu-item-image img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.5s; }
        .menu-item-card:hover .menu-item-image img { transform: scale(1.05); }
        
        /* Modals */
        .modal { 
            display: none; 
            position: fixed; 
            top: 0; left: 0; 
            width: 100%; height: 100%; 
            background: rgba(0,0,0,0.85); 
            z-index: 2000; 
            align-items: center; 
            justify-content: center; 
            padding: 20px;
        }
        .modal-content { 
            background: var(--dark-light); 
            padding: 30px; 
            border-radius: 20px; 
            max-width: 800px; 
            width: 100%; 
            max-height: 90vh; 
            overflow-y: auto; 
            border: 1px solid var(--gray);
            animation: modalSlideIn 0.3s ease;
        }
        @keyframes modalSlideIn {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .modal-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 25px; 
            padding-bottom: 15px; 
            border-bottom: 1px solid var(--gray); 
        }
        
        /* Form Rows */
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
        @media (max-width: 768px) { .form-row { grid-template-columns: 1fr; } }
        
        /* Form Labels */
        .form-label {
            display: block;
            color: var(--text-light);
            margin-bottom: 5px;
            font-size: 0.9rem;
            font-weight: 600;
        }
        .form-group {
            margin-bottom: 15px;
        }
        
        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--dark-light);
            border-left: 4px solid var(--gold);
            border-radius: 8px;
            padding: 15px 20px;
            min-width: 300px;
            z-index: 10000;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            animation: slideInRight 0.3s ease;
        }
        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(100%); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--dark); }
        ::-webkit-scrollbar-thumb { background: var(--gray); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--gold); }
        
        /* Pagination */
        .pagination { display: flex; gap: 8px; margin-top: 20px; justify-content: center; flex-wrap: wrap; }
        .page-btn {
            padding: 8px 12px;
            background: var(--dark);
            border: 1px solid var(--gray);
            color: var(--text-gray);
            border-radius: 6px;
            cursor: pointer;
            min-width: 40px;
        }
        .page-btn:hover { color: var(--gold); border-color: var(--gold); }
        .page-btn.active { background: var(--gold); color: var(--dark); border-color: var(--gold); }
        
        /* Loading */
        .loading { 
            position: fixed; 
            top: 0; left: 0; 
            width: 100%; height: 100%; 
            background: rgba(0,0,0,0.85); 
            z-index: 9999; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            flex-direction: column;
            color: var(--white);
        }
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid var(--gray);
            border-top: 3px solid var(--gold);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* Report Buttons */
        .report-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }
        .report-btn {
            padding: 8px 15px;
            background: var(--dark);
            border: 1px solid var(--gray);
            color: var(--text-gray);
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.2s;
        }
        .report-btn:hover {
            background: var(--gold);
            color: var(--dark);
            border-color: var(--gold);
        }
        
        /* Discount Badge */
        .discount-badge {
            background: var(--danger);
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: bold;
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 2;
        }
        
        /* Price Display */
        .original-price {
            text-decoration: line-through;
            color: var(--text-gray);
            font-size: 0.9rem;
        }
        .discounted-price {
            color: var(--danger);
            font-weight: bold;
        }
        
        /* Settings Tabs */
        .settings-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .settings-tab {
            padding: 10px 20px;
            background: var(--dark);
            border: 1px solid var(--gray);
            color: var(--text-gray);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .settings-tab:hover {
            border-color: var(--gold);
            color: var(--gold);
        }
        .settings-tab.active {
            background: var(--gold);
            color: var(--dark);
            border-color: var(--gold);
        }
        .settings-tab-content {
            display: block;
        }
        
        /* Invoice Settings */
        .invoice-preview-small {
            background: white;
            color: #333;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            border: 1px solid var(--gray);
            max-width: 500px;
        }
        
        /* Bank Account List */
        .bank-account-list {
            margin-top: 20px;
        }
        .bank-account-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: var(--dark);
            border-radius: 8px;
            margin-bottom: 10px;
            border: 1px solid var(--gray);
        }
        
        /* Audit Log */
        .audit-log {
            max-height: 300px;
            overflow-y: auto;
            background: var(--dark);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid var(--gray);
        }
        
        /* Proof Image */
        .proof-image-container {
            margin: 15px 0;
            text-align: center;
        }
        .proof-image {
            max-width: 100%;
            max-height: 400px;
            border-radius: 8px;
            border: 2px solid var(--gray);
        }
        
        /* Language Selector */
        .language-selector {
            background: var(--dark);
            color: var(--white);
            border: 1px solid var(--gray);
            border-radius: 5px;
            padding: 5px 10px;
            font-family: 'Montserrat', sans-serif;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="loginArea">
        <div class="login-card">
            <div class="login-tabs">
                <button class="login-tab active" onclick="showForm('login')" data-translate="login">
                    <i class="fas fa-sign-in-alt"></i> <span data-translate="login">LOGIN</span>
                </button>
                <button class="login-tab" onclick="showForm('signup')" data-translate="signup">
                    <i class="fas fa-user-plus"></i> <span data-translate="signup">SIGNUP</span>
                </button>
                <button class="login-tab" onclick="showForm('forgot')" data-translate="forgot">
                    <i class="fas fa-key"></i> <span data-translate="forgot">FORGOT</span>
                </button>
            </div>
            
            <div id="loginForm" class="login-form active">
                <h3 style="color: var(--gold); margin-bottom: 20px;">
                    <i class="fas fa-lock"></i> <span data-translate="adminLogin">Admin Login</span>
                </h3>
                <input type="email" id="loginEmail" class="input-pro" placeholder="Email" data-translate="email" value="admin@grandbistro.com">
                <input type="password" id="loginPass" class="input-pro" placeholder="Password" data-translate="password" value="admin123">
                <button id="loginBtn" class="btn-login" data-translate="login">
                    <i class="fas fa-sign-in-alt"></i> <span data-translate="login">LOGIN</span>
                </button>
            </div>
            
            <div id="signupForm" class="login-form">
                <h3 style="color: var(--gold); margin-bottom: 20px;">
                    <i class="fas fa-user-plus"></i> <span data-translate="createAccount">Create Admin Account</span>
                </h3>
                <input type="text" id="signupName" class="input-pro" placeholder="Full Name" data-translate="fullName">
                <input type="email" id="signupEmail" class="input-pro" placeholder="Email" data-translate="email">
                <input type="password" id="signupPass" class="input-pro" placeholder="Password (min. 6 chars)" data-translate="minChars">
                <input type="password" id="signupConfirm" class="input-pro" placeholder="Confirm Password" data-translate="confirmPassword">
                <button id="signupBtn" class="btn-login" data-translate="signup">
                    <i class="fas fa-user-plus"></i> <span data-translate="createAccount">CREATE ACCOUNT</span>
                </button>
            </div>
            
            <div id="forgotForm" class="login-form">
                <h3 style="color: var(--gold); margin-bottom: 20px;">
                    <i class="fas fa-key"></i> <span data-translate="resetPassword">Reset Password</span>
                </h3>
                <input type="email" id="forgotEmail" class="input-pro" placeholder="Email" data-translate="email">
                <button id="forgotBtn" class="btn-login" data-translate="resetPassword">
                    <i class="fas fa-paper-plane"></i> <span data-translate="resetPassword">RESET PASSWORD</span>
                </button>
            </div>
        </div>
    </div>

    <div id="adminContent">
        <div class="admin-container">
            <div class="admin-header">
                <div class="admin-title">
                    <i class="fas fa-crown"></i>
                    <span>THE GRAND BISTRO ADMIN - FIREBASE</span>
                </div>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <div>
                        <div style="color: var(--text-light); font-weight: 600;">
                            <span data-translate="welcome">Welcome</span>, <span id="adminName" style="color: var(--gold);"></span>
                        </div>
                        <div id="adminRole" style="background: var(--gold); color: var(--dark); padding: 5px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 700;">
                            ADMIN
                        </div>
                    </div>
                    <button onclick="logout()" class="action-btn btn-delete" data-translate="logout">
                        <i class="fas fa-sign-out-alt"></i> <span data-translate="logout">Logout</span>
                    </button>
                </div>
            </div>
            
            <div class="admin-tabs">
                <button class="admin-tab active" onclick="showAdminTab('dashboard')" data-translate="dashboard">
                    <i class="fas fa-tachometer-alt"></i> <span data-translate="dashboard">Dashboard</span>
                </button>
                <button class="admin-tab" onclick="showAdminTab('orders')" data-translate="orders">
                    <i class="fas fa-clipboard-list"></i> <span data-translate="orders">Orders</span>
                </button>
                <button class="admin-tab" onclick="showAdminTab('menu')" data-translate="menu">
                    <i class="fas fa-utensils"></i> <span data-translate="menu">Menu</span>
                </button>
                <button class="admin-tab" onclick="showAdminTab('payments')" data-translate="payments">
                    <i class="fas fa-credit-card"></i> <span data-translate="payments">Payments</span>
                </button>
                <button class="admin-tab" onclick="showAdminTab('settings')" data-translate="settings">
                    <i class="fas fa-cog"></i> <span data-translate="settings">Settings</span>
                </button>
            </div>
            
            <!-- Dashboard Tab -->
            <div id="dashboardTab" class="admin-tab-content">
                <div class="stats-container">
                    <div class="stat-card gold">
                        <div class="stat-value" id="incomeToday">Rp 0</div>
                        <div style="color: rgba(0,0,0,0.8); font-weight: 600;" data-translate="incomeToday">OMZET HARI INI</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="incomeMonth">Rp 0</div>
                        <div style="color: var(--text-gray); font-weight: 600;" data-translate="incomeMonth">OMZET BULAN INI</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalOrders">0</div>
                        <div style="color: var(--text-gray); font-weight: 600;" data-translate="totalOrders">TOTAL ORDER</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="pendingPayments">0</div>
                        <div style="color: var(--text-gray); font-weight: 600;" data-translate="pendingPayments">MENUNGGU BUKTI</div>
                    </div>
                </div>
                
                <div class="admin-grid">
                    <div>
                        <div class="card">
                            <h3 style="color: var(--gold); margin-bottom: 20px;">
                                <i class="fas fa-chart-bar"></i> <span data-translate="financeReport">FINANCE REPORT</span>
                            </h3>
                            <div class="chart-controls">
                                <button class="chart-btn active" onclick="changeChart('daily')" data-translate="daily">Harian</button>
                                <button class="chart-btn" onclick="changeChart('weekly')" data-translate="weekly">Mingguan</button>
                                <button class="chart-btn" onclick="changeChart('monthly')" data-translate="monthly">Bulanan</button>
                            </div>
                            <div class="chart-container">
                                <canvas id="financeChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="card">
                            <h3 style="color: var(--gold); margin-bottom: 20px;">
                                <i class="fas fa-file-download"></i> <span data-translate="downloadReport">DOWNLOAD REPORT</span>
                            </h3>
                            <div class="report-buttons">
                                <button class="report-btn" onclick="downloadReport('daily', 'csv')">
                                    <i class="fas fa-file-csv"></i> <span data-translate="daily">Daily</span> CSV
                                </button>
                                <button class="report-btn" onclick="downloadReport('weekly', 'excel')">
                                    <i class="fas fa-file-excel"></i> <span data-translate="weekly">Weekly</span> Excel
                                </button>
                                <button class="report-btn" onclick="downloadReport('monthly', 'pdf')">
                                    <i class="fas fa-file-pdf"></i> <span data-translate="monthly">Monthly</span> PDF
                                </button>
                                <button class="report-btn" onclick="downloadReport('custom', 'excel')">
                                    <i class="fas fa-calendar-alt"></i> <span data-translate="customRange">Custom Range</span>
                                </button>
                            </div>
                            <div id="customReportRange" style="display: none; margin-top: 15px;">
                                <div class="form-row">
                                    <input type="date" id="reportStartDate" class="input-pro" data-translate="selectDate">
                                    <input type="date" id="reportEndDate" class="input-pro" data-translate="selectDate">
                                </div>
                                <div class="report-buttons">
                                    <button class="report-btn" onclick="generateCustomReport('csv')">
                                        <i class="fas fa-file-csv"></i> CSV
                                    </button>
                                    <button class="report-btn" onclick="generateCustomReport('excel')">
                                        <i class="fas fa-file-excel"></i> Excel
                                    </button>
                                    <button class="report-btn" onclick="generateCustomReport('pdf')">
                                        <i class="fas fa-file-pdf"></i> PDF
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <div class="card">
                            <h3 style="color: var(--gold); margin-bottom: 20px;">
                                <i class="fas fa-history"></i> <span data-translate="recentOrders">10 RECENT ORDERS</span>
                            </h3>
                            <div class="table-container">
                                <table class="table-pro">
                                    <thead>
                                        <tr>
                                            <th>NO</th>
                                            <th data-translate="orderId">ORDER ID</th>
                                            <th data-translate="customer">CUSTOMER</th>
                                            <th data-translate="total">TOTAL</th>
                                            <th data-translate="status">STATUS</th>
                                            <th data-translate="action">AKSI</th>
                                        </tr>
                                    </thead>
                                    <tbody id="recentOrders">
                                        <!-- Recent orders loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div class="card">
                            <h3 style="color: var(--gold); margin-bottom: 20px;">
                                <i class="fas fa-clock"></i> <span data-translate="pendingVerification">PEMBAYARAN MENUNGGU</span>
                            </h3>
                            <div class="table-container">
                                <table class="table-pro">
                                    <thead>
                                        <tr>
                                            <th data-translate="orderId">ORDER ID</th>
                                            <th data-translate="customer">CUSTOMER</th>
                                            <th data-translate="amount">JUMLAH</th>
                                            <th data-translate="proof">BUKTI</th>
                                            <th data-translate="action">AKSI</th>
                                        </tr>
                                    </thead>
                                    <tbody id="pendingPaymentsList">
                                        <!-- Pending payments loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Orders Tab -->
            <div id="ordersTab" class="admin-tab-content" style="display: none;">
                <div class="card">
                    <h3 style="color: var(--gold); margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
                        <span><i class="fas fa-clipboard-list"></i> <span data-translate="allOrders">SEMUA PESANAN</span></span>
                        <span id="ordersCount" style="color: var(--text-gray); font-size: 0.9rem;"></span>
                    </h3>
                    
                    <div style="display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap;">
                        <input type="date" id="filterDate" class="input-pro" onchange="loadAllOrders()" style="width: auto;" data-translate="selectDate">
                        <select id="filterStatus" class="input-pro" onchange="loadAllOrders()" style="width: auto;">
                            <option value="all" data-translate="allStatus">Semua Status</option>
                            <option value="pending" data-translate="pending">Pending</option>
                            <option value="waiting_payment" data-translate="waitingPayment">Menunggu Pembayaran</option>
                            <option value="paid" data-translate="paid">Paid</option>
                            <option value="cancelled" data-translate="cancelled">Cancelled</option>
                        </select>
                        <button onclick="loadAllOrders()" class="action-btn btn-gold" data-translate="filter">
                            <i class="fas fa-filter"></i> <span data-translate="filter">Filter</span>
                        </button>
                        <button onclick="resetFilter()" class="action-btn" data-translate="reset">
                            <i class="fas fa-redo"></i> <span data-translate="reset">Reset</span>
                        </button>
                    </div>
                    
                    <div class="table-container">
                        <table class="table-pro">
                            <thead>
                                <tr>
                                    <th>NO</th>
                                    <th data-translate="time">WAKTU</th>
                                    <th data-translate="orderId">ORDER ID</th>
                                    <th data-translate="customer">CUSTOMER</th>
                                    <th data-translate="email">EMAIL</th>
                                    <th data-translate="total">TOTAL</th>
                                    <th data-translate="status">STATUS</th>
                                    <th data-translate="action">AKSI</th>
                                </tr>
                            </thead>
                            <tbody id="orderList">
                                <!-- All orders loaded here -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div id="pagination" class="pagination"></div>
                </div>
            </div>
            
            <!-- Menu Tab -->
            <div id="menuTab" class="admin-tab-content" style="display: none;">
                <div class="admin-grid">
                    <div>
                        <div class="card">
                            <h3 style="color: var(--gold); margin-bottom: 20px;">
                                <i class="fas fa-plus-circle"></i> <span data-translate="addEditMenu">TAMBAH/EDIT MENU</span>
                            </h3>
                            <input type="hidden" id="menuId">
                            <input type="text" id="mName" class="input-pro" placeholder="Menu Name" data-translate="menuName">
                            <div class="form-row">
                                <input type="number" id="mPrice" class="input-pro" placeholder="Price" data-translate="price">
                                <input type="number" id="mCogs" class="input-pro" placeholder="Cost" data-translate="cost">
                            </div>
                            <div class="form-row">
                                <input type="text" id="mCat" class="input-pro" placeholder="Category" data-translate="category">
                                <input type="number" id="mStock" class="input-pro" placeholder="Stock" data-translate="stock" value="999">
                            </div>
                            
                            <!-- Discount Settings -->
                            <div style="margin: 15px 0; padding: 15px; background: var(--dark); border-radius: 8px;">
                                <h4 style="color: var(--gold); margin-bottom: 10px; font-size: 0.9rem;">
                                    <i class="fas fa-tag"></i> <span data-translate="setDiscount">SET DISKON</span>
                                </h4>
                                <div class="form-row">
                                    <select id="mDiscountType" class="input-pro">
                                        <option value="" data-translate="noDiscount">Tidak Ada Diskon</option>
                                        <option value="percentage" data-translate="percentage">Persentase (%)</option>
                                        <option value="amount" data-translate="nominal">Nominal (Rp)</option>
                                    </select>
                                    <input type="number" id="mDiscountValue" class="input-pro" placeholder="Discount Value" data-translate="discountValue" min="0">
                                </div>
                            </div>
                            
                            <input type="text" id="mImg" class="input-pro" placeholder="Image Link" data-translate="imageLink">
                            <textarea id="mDesc" class="input-pro" placeholder="Description" data-translate="description" rows="3" style="margin-bottom: 20px;"></textarea>
                            <button onclick="saveMenu()" class="btn-login" data-translate="saveMenu">
                                <i class="fas fa-save"></i> <span data-translate="saveMenu">SIMPAN MENU</span>
                            </button>
                        </div>
                        
                        <div class="card">
                            <h3 style="color: var(--gold); margin-bottom: 20px;">
                                <i class="fas fa-calendar-times"></i> <span data-translate="blockDate">BLOKIR TANGGAL</span>
                            </h3>
                            <input type="date" id="blockDate" class="input-pro" style="margin-bottom: 15px;" data-translate="selectDate">
                            <select id="blockReason" class="input-pro" style="margin-bottom: 20px;">
                                <option value="fully_booked" data-translate="fullyBooked">Full Booked</option>
                                <option value="holiday" data-translate="holiday">Holiday</option>
                                <option value="maintenance" data-translate="maintenance">Maintenance</option>
                                <option value="private_event" data-translate="privateEvent">Private Event</option>
                            </select>
                            <button onclick="blockDateAction()" class="btn-login" data-translate="blockDate">
                                <i class="fas fa-ban"></i> <span data-translate="blockDate">BLOKIR TANGGAL</span>
                            </button>
                            <div id="blockedDatesList" style="margin-top: 20px; padding: 15px; background: var(--dark); border-radius: 8px; max-height: 200px; overflow-y: auto;">
                                <div style="color: var(--gold); font-weight: 600; margin-bottom: 10px;" data-translate="blockedDates">Tanggal Terblokir:</div>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <div class="card">
                            <h3 style="color: var(--gold); margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
                                <span><i class="fas fa-utensils"></i> <span data-translate="menuList">DAFTAR MENU</span></span>
                                <input type="text" id="searchMenu" class="input-pro" placeholder="Search menu..." data-translate="searchMenu" style="width: 200px;" onkeyup="searchMenuItems()">
                            </h3>
                            <div id="menuList" class="menu-grid-admin"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Payments Tab -->
            <div id="paymentsTab" class="admin-tab-content" style="display: none;">
                <div class="admin-grid">
                    <div>
                        <div class="card">
                            <h3 style="color: var(--gold); margin-bottom: 20px;">
                                <i class="fas fa-university"></i> <span data-translate="manageBank">KELOLA REKENING BANK</span>
                            </h3>
                            <input type="text" id="bankName" class="input-pro" placeholder="Bank Name" data-translate="bankName">
                            <input type="text" id="accountName" class="input-pro" placeholder="Account Holder Name" data-translate="accountName">
                            <input type="text" id="accountNumber" class="input-pro" placeholder="Account Number" data-translate="accountNumber">
                            <button onclick="addBankAccount()" class="btn-login" style="margin-bottom: 20px;" data-translate="addAccount">
                                <i class="fas fa-plus"></i> <span data-translate="addAccount">TAMBAH REKENING</span>
                            </button>
                            <div id="bankAccountsList" class="bank-account-list">
                                <!-- Bank accounts loaded here -->
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <div class="card">
                            <h3 style="color: var(--gold); margin-bottom: 20px;">
                                <i class="fas fa-credit-card"></i> <span data-translate="paymentVerification">VERIFIKASI PEMBAYARAN</span>
                            </h3>
                            <div class="table-container">
                                <table class="table-pro">
                                    <thead>
                                        <tr>
                                            <th data-translate="orderId">ORDER ID</th>
                                            <th data-translate="customer">CUSTOMER</th>
                                            <th data-translate="total">TOTAL</th>
                                            <th data-translate="proof">BUKTI TF</th>
                                            <th data-translate="uploadTime">WAKTU UPLOAD</th>
                                            <th data-translate="action">AKSI</th>
                                        </tr>
                                    </thead>
                                    <tbody id="paymentVerificationList">
                                        <!-- Payment verification list -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Settings Tab -->
            <div id="settingsTab" class="admin-tab-content" style="display: none;">
                <div class="settings-tabs">
                    <button class="settings-tab active" onclick="showSettingsTab('general')" data-translate="general">
                        <i class="fas fa-store"></i> <span data-translate="storeInfo">Info Toko</span>
                    </button>
                    <button class="settings-tab" onclick="showSettingsTab('tax')" data-translate="tax">
                        <i class="fas fa-percentage"></i> <span data-translate="tax">Tax & Fee</span>
                    </button>
                    <button class="settings-tab" onclick="showSettingsTab('invoice')" data-translate="invoice">
                        <i class="fas fa-file-invoice"></i> <span data-translate="invoice">Invoice</span>
                    </button>
                    <button class="settings-tab" onclick="showSettingsTab('email')" data-translate="email">
                        <i class="fas fa-envelope"></i> <span data-translate="email">Email</span>
                    </button>
                    <button class="settings-tab" onclick="showSettingsTab('system')" data-translate="system">
                        <i class="fas fa-cog"></i> <span data-translate="system">System</span>
                    </button>
                </div>
                
                <!-- General Settings -->
                <div id="generalSettings" class="settings-tab-content">
                    <div class="admin-grid">
                        <div>
                            <div class="card">
                                <h3 style="color: var(--gold); margin-bottom: 20px;">
                                    <i class="fas fa-store"></i> <span data-translate="storeInfo">INFORMASI TOKO</span>
                                </h3>
                                <input type="text" id="restaurantName" class="input-pro" placeholder="Restaurant Name" data-translate="restaurantName" style="margin-bottom: 15px;">
                                <input type="text" id="restaurantPhone" class="input-pro" placeholder="Phone" data-translate="phone" style="margin-bottom: 15px;">
                                <input type="text" id="restaurantEmail" class="input-pro" placeholder="Email" data-translate="email" style="margin-bottom: 15px;">
                                <textarea id="restaurantAddress" class="input-pro" placeholder="Address" data-translate="address" rows="3" style="margin-bottom: 15px;"></textarea>
                                <div class="form-row">
                                    <input type="text" id="openingTime" class="input-pro" placeholder="Opening Time" data-translate="openingTime">
                                    <input type="text" id="closingTime" class="input-pro" placeholder="Closing Time" data-translate="closingTime">
                                </div>
                                <button onclick="saveGeneralSettings()" class="btn-login" style="margin-top: 20px;" data-translate="saveStoreInfo">
                                    <i class="fas fa-save"></i> <span data-translate="saveStoreInfo">SIMPAN INFORMASI TOKO</span>
                                </button>
                            </div>
                        </div>
                        
                        <div>
                            <div class="card">
                                <h3 style="color: var(--gold); margin-bottom: 20px;">
                                    <i class="fas fa-map-marker-alt"></i> <span data-translate="otherInfo">INFORMASI LAINNYA</span>
                                </h3>
                                <input type="text" id="restaurantWebsite" class="input-pro" placeholder="Website" data-translate="website" style="margin-bottom: 15px;">
                                <input type="text" id="restaurantInstagram" class="input-pro" placeholder="Instagram" data-translate="instagram" style="margin-bottom: 15px;">
                                <input type="text" id="restaurantFacebook" class="input-pro" placeholder="Facebook" data-translate="facebook" style="margin-bottom: 15px;">
                                <textarea id="restaurantDescription" class="input-pro" placeholder="Store Description" data-translate="storeDescription" rows="4" style="margin-bottom: 15px;"></textarea>
                                <div class="invoice-preview-small" id="storeInfoPreview">
                                    <div style="text-align: center; border-bottom: 1px solid #ccc; padding-bottom: 10px; margin-bottom: 15px;">
                                        <h3 id="previewStoreName" style="margin: 0; color: #333;">THE GRAND BISTRO</h3>
                                        <p id="previewStoreAddress" style="margin: 5px 0; font-size: 0.9em; color: #666;">Jl. Kemang Raya No. 123, Jakarta</p>
                                        <p id="previewStorePhone" style="margin: 5px 0; font-size: 0.9em; color: #666;">Telp: (021) 1234-5678</p>
                                    </div>
                                    <p style="font-size: 0.8em; color: #888; text-align: center;">
                                        Preview informasi toko di invoice
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Tax & Fee Settings -->
                <div id="taxSettings" class="settings-tab-content" style="display: none;">
                    <div class="admin-grid">
                        <div>
                            <div class="card">
                                <h3 style="color: var(--gold); margin-bottom: 20px;">
                                    <i class="fas fa-percentage"></i> <span data-translate="taxSettings">PENGATURAN TAX & SERVICE FEE</span>
                                </h3>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label" data-translate="taxName">Tax Name</label>
                                        <input type="text" id="taxName" class="input-pro" placeholder="PPN" data-translate="taxName">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label" data-translate="taxPercentage">Tax Percentage (%)</label>
                                        <input type="number" id="taxPercentage" class="input-pro" placeholder="10" min="0" max="100" step="0.1" data-translate="taxPercentage">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label" data-translate="serviceFeeName">Service Fee Name</label>
                                        <input type="text" id="serviceFeeName" class="input-pro" placeholder="Service Charge" data-translate="serviceFeeName">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label" data-translate="serviceFeePercentage">Service Fee (%)</label>
                                        <input type="number" id="serviceFeePercentage" class="input-pro" placeholder="5" min="0" max="100" step="0.1" data-translate="serviceFeePercentage">
                                    </div>
                                </div>
                                <div style="margin: 20px 0; padding: 15px; background: var(--dark); border-radius: 8px;">
                                    <h4 style="color: var(--gold); margin-bottom: 10px; font-size: 0.9rem;" data-translate="calculationPreview">Preview Kalkulasi</h4>
                                    <div id="taxPreview">
                                        <p data-translate="subtotal">Subtotal: <span id="previewSubtotal">Rp 100,000</span></p>
                                        <p>Tax (<span id="previewTaxPercent">10%</span>): <span id="previewTaxAmount">Rp 10,000</span></p>
                                        <p>Service Fee (<span id="previewServicePercent">5%</span>): <span id="previewServiceAmount">Rp 5,000</span></p>
                                        <p style="font-weight: bold;" data-translate="total">Total: <span id="previewTotal">Rp 115,000</span></p>
                                    </div>
                                </div>
                                <button onclick="saveTaxSettings()" class="btn-login" data-translate="saveSettings">
                                    <i class="fas fa-save"></i> <span data-translate="saveSettings">SIMPAN PENGATURAN</span>
                                </button>
                            </div>
                        </div>
                        
                        <div>
                            <div class="card">
                                <h3 style="color: var(--gold); margin-bottom: 20px;">
                                    <i class="fas fa-tag"></i> <span data-translate="taxSettings">PENGATURAN DISKON GLOBAL</span>
                                </h3>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label" data-translate="minOrderDiscount">Minimum Order untuk Diskon</label>
                                        <input type="number" id="minOrderDiscount" class="input-pro" placeholder="0" min="0" data-translate="minOrderDiscount">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label" data-translate="globalDiscount">Diskon Global (%)</label>
                                        <input type="number" id="globalDiscount" class="input-pro" placeholder="0" min="0" max="100" data-translate="globalDiscount">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label" data-translate="promoCode">Promo Code</label>
                                        <input type="text" id="promoCode" class="input-pro" placeholder="GRAND10" data-translate="promoCode">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label" data-translate="promoValue">Promo Value (%)</label>
                                        <input type="number" id="promoValue" class="input-pro" placeholder="10" min="0" max="100" data-translate="promoValue">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label" data-translate="promoExpiry">Promo Expiry Date</label>
                                        <input type="date" id="promoExpiry" class="input-pro" data-translate="promoExpiry">
                                    </div>
                                </div>
                                <button onclick="saveDiscountSettings()" class="btn-login" data-translate="saveSettings">
                                    <i class="fas fa-save"></i> <span data-translate="saveSettings">SIMPAN DISKON</span>
                                </button>
                            </div>
                            
                            <div class="card">
                                <h3 style="color: var(--gold); margin-bottom: 20px;">
                                    <i class="fas fa-history"></i> AUDIT LOG
                                </h3>
                                <div id="logArea" class="audit-log"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Invoice Settings -->
                <div id="invoiceSettings" class="settings-tab-content" style="display: none;">
                    <div class="admin-grid">
                        <div>
                            <div class="card">
                                <h3 style="color: var(--gold); margin-bottom: 20px;">
                                    <i class="fas fa-file-invoice"></i> <span data-translate="invoiceTemplate">TEMPLATE INVOICE</span>
                                </h3>
                                <input type="text" id="invoicePrefix" class="input-pro" placeholder="Invoice Prefix" data-translate="invoicePrefix" style="margin-bottom: 15px;">
                                <input type="text" id="invoiceFooter" class="input-pro" placeholder="Invoice Footer" data-translate="invoiceFooter" style="margin-bottom: 15px;">
                                <textarea id="invoiceTerms" class="input-pro" placeholder="Terms & Conditions" data-translate="invoiceTerms" rows="4" style="margin-bottom: 15px;"></textarea>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label" data-translate="logoUrl">Logo URL</label>
                                        <input type="text" id="logoUrl" class="input-pro" placeholder="https://..." data-translate="logoUrl">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label" data-translate="primaryColor">Primary Color</label>
                                        <input type="color" id="primaryColor" class="input-pro" value="#d4af37" data-translate="primaryColor">
                                    </div>
                                </div>
                                <button onclick="saveInvoiceSettings()" class="btn-login" data-translate="saveTemplate">
                                    <i class="fas fa-save"></i> <span data-translate="saveTemplate">SIMPAN TEMPLATE</span>
                                </button>
                            </div>
                        </div>
                        
                        <div>
                            <div class="card">
                                <h3 style="color: var(--gold); margin-bottom: 20px;">
                                    <i class="fas fa-eye"></i> <span data-translate="invoicePreview">PREVIEW INVOICE</span>
                                </h3>
                                <div class="invoice-preview-small">
                                    <div style="text-align: center; border-bottom: 1px solid #ccc; padding-bottom: 10px; margin-bottom: 15px;">
                                        <h3 style="margin: 0; color: #333;">THE GRAND BISTRO</h3>
                                        <p style="margin: 5px 0; font-size: 0.9em; color: #666;">Jl. Kemang Raya No. 123, Jakarta</p>
                                        <p style="margin: 5px 0; font-size: 0.9em; color: #666;">Telp: (021) 1234-5678 | Email: rsvp@grandbistro.com</p>
                                    </div>
                                    
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                                        <div>
                                            <strong>INVOICE</strong><br>
                                            No: <span id="previewInvoiceNo">GB20231231001</span><br>
                                            Date: <span id="previewInvoiceDate">31 Dec 2023</span>
                                        </div>
                                        <div>
                                            <strong>BILL TO:</strong><br>
                                            <span id="previewCustomer">John Doe</span><br>
                                            <span id="previewCustomerEmail">john@example.com</span>
                                        </div>
                                    </div>
                                    
                                    <table style="width: 100%; border-collapse: collapse; margin: 10px 0; font-size: 0.8em;">
                                        <thead>
                                            <tr style="border-bottom: 1px solid #ccc;">
                                                <th style="text-align: left; padding: 5px;">Item</th>
                                                <th style="text-align: center; padding: 5px;">Qty</th>
                                                <th style="text-align: right; padding: 5px;">Price</th>
                                                <th style="text-align: right; padding: 5px;">Total</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td style="padding: 5px;">Spaghetti Carbonara</td>
                                                <td style="text-align: center; padding: 5px;">1</td>
                                                <td style="text-align: right; padding: 5px;">Rp 85,000</td>
                                                <td style="text-align: right; padding: 5px;">Rp 85,000</td>
                                            </tr>
                                            <tr>
                                                <td style="padding: 5px;">Coca Cola</td>
                                                <td style="text-align: center; padding: 5px;">2</td>
                                                <td style="text-align: right; padding: 5px;">Rp 15,000</td>
                                                <td style="text-align: right; padding: 5px;">Rp 30,000</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    
                                    <div style="border-top: 1px solid #ccc; padding-top: 10px; margin-top: 10px;">
                                        <div style="display: flex; justify-content: space-between; font-size: 0.9em;">
                                            <span data-translate="subtotal">Subtotal:</span>
                                            <span>Rp 115,000</span>
                                        </div>
                                        <div style="display: flex; justify-content: space-between; font-size: 0.9em;">
                                            <span>PPN (10%):</span>
                                            <span>Rp 11,500</span>
                                        </div>
                                        <div style="display: flex; justify-content: space-between; font-size: 0.9em;">
                                            <span>Service Charge (5%):</span>
                                            <span>Rp 5,750</span>
                                        </div>
                                        <div style="display: flex; justify-content: space-between; font-weight: bold; font-size: 1em; margin-top: 5px;">
                                            <span data-translate="total">TOTAL:</span>
                                            <span>Rp 132,250</span>
                                        </div>
                                    </div>
                                    
                                    <div style="margin-top: 15px; padding-top: 10px; border-top: 1px dashed #ccc; font-size: 0.7em; color: #666; text-align: center;">
                                        <p id="previewInvoiceFooter">Thank you for dining with us! This is a computer-generated invoice.</p>
                                    </div>
                                </div>
                                
                                <button onclick="updateInvoicePreview()" class="action-btn btn-gold" style="margin-top: 15px;" data-translate="refreshPreview">
                                    <i class="fas fa-sync"></i> <span data-translate="refreshPreview">Refresh Preview</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Email Settings -->
                <div id="emailSettings" class="settings-tab-content" style="display: none;">
                    <div class="admin-grid">
                        <div>
                            <div class="card">
                                <h3 style="color: var(--gold); margin-bottom: 20px;">
                                    <i class="fas fa-envelope"></i> <span data-translate="emailTemplate">EMAIL TEMPLATE</span>
                                </h3>
                                <select id="emailTemplateSelect" class="input-pro" onchange="loadEmailTemplate()">
                                    <option value="order_confirmation" data-translate="orderConfirmation">Konfirmasi Pesanan</option>
                                    <option value="payment_confirmation" data-translate="paymentConfirmation">Konfirmasi Pembayaran</option>
                                    <option value="invoice" data-translate="invoice">Invoice</option>
                                    <option value="reminder" data-translate="reminder">Pengingat</option>
                                    <option value="welcome" data-translate="welcomeEmail">Welcome Email</option>
                                </select>
                                <input type="text" id="emailSubject" class="input-pro" placeholder="Email Subject" data-translate="emailSubject" style="margin-bottom: 15px;">
                                <textarea id="emailBody" class="input-pro" placeholder="Email Content" data-translate="emailBody" rows="10" style="margin-bottom: 20px;"></textarea>
                                <div style="font-size: 0.8em; color: var(--text-gray); margin-bottom: 10px;">
                                    <strong data-translate="variables">Variables:</strong> {customer_name}, {order_id}, {order_date}, {order_total}, {restaurant_name}
                                </div>
                                <button onclick="saveEmailTemplate()" class="btn-login" data-translate="saveTemplate">
                                    <i class="fas fa-save"></i> <span data-translate="saveTemplate">SIMPAN TEMPLATE</span>
                                </button>
                            </div>
                        </div>
                        
                        <div>
                            <div class="card">
                                <h3 style="color: var(--gold); margin-bottom: 20px;">
                                    <i class="fas fa-paper-plane"></i> <span data-translate="testEmail">TEST EMAIL</span>
                                </h3>
                                <input type="email" id="testEmail" class="input-pro" placeholder="Email for testing" data-translate="testEmailPlaceholder" style="margin-bottom: 15px;">
                                <select id="testEmailType" class="input-pro" style="margin-bottom: 15px;">
                                    <option value="order_confirmation" data-translate="orderConfirmation">Konfirmasi Pesanan</option>
                                    <option value="invoice" data-translate="invoice">Invoice</option>
                                </select>
                                <button onclick="sendTestEmail()" class="btn-login" style="margin-bottom: 15px;" data-translate="sendTest">
                                    <i class="fas fa-paper-plane"></i> <span data-translate="sendTest">KIRIM TEST EMAIL</span>
                                </button>
                                
                                <div class="card">
                                    <h3 style="color: var(--gold); margin-bottom: 20px; font-size: 1rem;">
                                        <i class="fas fa-user-shield"></i> <span data-translate="manageAdmin">KELOLA ADMIN</span>
                                    </h3>
                                    <div id="adminList" style="margin-bottom: 20px;">
                                        <!-- Admin list loaded here -->
                                    </div>
                                    <button onclick="showAddAdminModal()" class="action-btn btn-gold" data-translate="addAdmin">
                                        <i class="fas fa-user-plus"></i> <span data-translate="addAdmin">TAMBAH ADMIN</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- System Settings -->
                <div id="systemSettings" class="settings-tab-content" style="display: none;">
                    <div class="admin-grid">
                        <div>
                            <div class="card">
                                <h3 style="color: var(--gold); margin-bottom: 20px;">
                                    <i class="fas fa-database"></i> <span data-translate="backupRestore">BACKUP & RESTORE</span>
                                </h3>
                                <button onclick="backupData()" class="action-btn btn-gold" style="margin-bottom: 10px; width: 100%;" data-translate="backupAll">
                                    <i class="fas fa-download"></i> <span data-translate="backupAll">BACKUP SEMUA DATA</span>
                                </button>
                                <button onclick="restoreData()" class="action-btn" style="margin-bottom: 10px; width: 100%;" data-translate="restoreData">
                                    <i class="fas fa-upload"></i> <span data-translate="restoreData">RESTORE DATA</span>
                                </button>
                                <input type="file" id="restoreFile" accept=".json" style="display: none;">
                                
                                <div style="margin-top: 20px;">
                                    <h4 style="color: var(--gold); font-size: 0.9rem; margin-bottom: 10px;" data-translate="resetSystem">Reset System</h4>
                                    <button onclick="resetSystem()" class="action-btn btn-delete" style="width: 100%;" data-translate="resetAllData">
                                        <i class="fas fa-trash"></i> <span data-translate="resetAllData">RESET SEMUA DATA</span>
                                    </button>
                                    <p style="font-size: 0.8em; color: var(--text-gray); margin-top: 10px;">
                                        Warning: Aksi ini akan menghapus semua data kecuali admin accounts.
                                    </p>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <div class="card">
                                <h3 style="color: var(--gold); margin-bottom: 20px;">
                                    <i class="fas fa-info-circle"></i> <span data-translate="systemInfo">SYSTEM INFORMATION</span>
                                </h3>
                                <div style="background: var(--dark); padding: 15px; border-radius: 8px;">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                        <span data-translate="version">Version:</span>
                                        <span id="systemVersion">1.0.0</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                        <span data-translate="totalMenu">Total Menu Items:</span>
                                        <span id="totalMenuItems">0</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                        <span data-translate="totalOrder">Total Orders:</span>
                                        <span id="totalSystemOrders">0</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                        <span data-translate="totalCustomers">Total Customers:</span>
                                        <span id="totalCustomers">0</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                        <span data-translate="dbSize">Database Size:</span>
                                        <span id="databaseSize">0 KB</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                        <span data-translate="lastBackup">Last Backup:</span>
                                        <span id="lastBackup">-</span>
                                    </div>
                                </div>
                                
                                <button onclick="refreshSystemInfo()" class="action-btn" style="margin-top: 15px; width: 100%;" data-translate="refreshInfo">
                                    <i class="fas fa-sync"></i> <span data-translate="refreshInfo">REFRESH INFO</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Order Detail Modal -->
    <div id="orderDetailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 style="color: var(--gold);"><i class="fas fa-file-invoice"></i> <span data-translate="detailOrder">DETAIL PESANAN & INVOICE</span></h3>
                <button onclick="closeModal('orderDetailModal')" style="background: none; border: none; color: var(--text-gray); font-size: 1.5rem; cursor: pointer;">×</button>
            </div>
            <div id="orderDetailContent"></div>
            <div class="invoice-preview" id="invoicePreview" style="display: none;">
                <!-- Invoice preview loaded here -->
            </div>
            <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
                <button onclick="printInvoice()" class="action-btn btn-gold" data-translate="printInvoice">
                    <i class="fas fa-print"></i> <span data-translate="printInvoice">Print Invoice</span>
                </button>
                <button onclick="sendInvoiceEmail()" class="action-btn btn-success" data-translate="sendEmail">
                    <i class="fas fa-paper-plane"></i> <span data-translate="sendEmail">Kirim Email</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Payment Proof Modal -->
    <div id="paymentProofModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 style="color: var(--gold);"><i class="fas fa-receipt"></i> <span data-translate="verifyPayment">VERIFIKASI BUKTI PEMBAYARAN</span></h3>
                <button onclick="closeModal('paymentProofModal')" style="background: none; border: none; color: var(--text-gray); font-size: 1.5rem; cursor: pointer;">×</button>
            </div>
            <div id="paymentProofContent"></div>
            <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
                <button onclick="verifyPayment(true)" class="action-btn btn-success" data-translate="acceptPayment">
                    <i class="fas fa-check"></i> <span data-translate="acceptPayment">Terima Pembayaran</span>
                </button>
                <button onclick="verifyPayment(false)" class="action-btn btn-delete" data-translate="rejectPayment">
                    <i class="fas fa-times"></i> <span data-translate="rejectPayment">Tolak Pembayaran</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Add Admin Modal -->
    <div id="addAdminModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 style="color: var(--gold);"><i class="fas fa-user-plus"></i> <span data-translate="addNewAdmin">TAMBAH ADMIN BARU</span></h3>
                <button onclick="closeModal('addAdminModal')" style="background: none; border: none; color: var(--text-gray); font-size: 1.5rem; cursor: pointer;">×</button>
            </div>
            <input type="text" id="newAdminName" class="input-pro" placeholder="Full Name" data-translate="fullName">
            <input type="email" id="newAdminEmail" class="input-pro" placeholder="Email" data-translate="email">
            <select id="newAdminRole" class="input-pro">
                <option value="admin" data-translate="adminRole">Admin</option>
                <option value="staff" data-translate="staff">Staff</option>
            </select>
            <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
                <button onclick="addNewAdmin()" class="action-btn btn-success" data-translate="save">
                    <i class="fas fa-save"></i> <span data-translate="save">SIMPAN</span>
                </button>
                <button onclick="closeModal('addAdminModal')" class="action-btn" data-translate="cancel">BATAL</button>
            </div>
        </div>
    </div>

<script>
// ===== FIREBASE CONFIGURATION =====
const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT.appspot.com",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
};

// ===== STATE =====
let state = {
    user: null,
    orders: [],
    allOrders: [],
    menu: [],
    bankAccounts: [],
    settings: {
        general: {},
        tax: { percentage: 10, name: 'PPN', serviceFee: 5, serviceName: 'Service Charge' },
        invoice: {},
        email: {}
    },
    stats: { today: 0, month: 0, total: 0, pending: 0 },
    page: 1,
    chart: null,
    db: null,
    auth: null,
    storage: null,
    currentOrderId: null,
    currentLanguage: 'id'
};

// ===== UTILS =====
const utils = {
    showNotification(message, type = 'info') {
        const colors = { success: '#28a745', error: '#dc3545', warning: '#ffc107', info: '#d4af37' };
        
        const notification = document.createElement('div');
        notification.className = 'notification';
        notification.style.borderLeftColor = colors[type] || colors.info;
        notification.innerHTML = `
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                <strong>${type.toUpperCase()}</strong>
                <button onclick="this.parentElement.parentElement.remove()" style="background: none; border: none; color: var(--text-gray); cursor: pointer;">×</button>
            </div>
            <div>${message}</div>
        `;
        document.body.appendChild(notification);
        setTimeout(() => notification.remove(), 5000);
    },
    
    formatCurrency(amount) {
        return 'Rp ' + parseInt(amount).toLocaleString('id-ID');
    },
    
    formatDate(date) {
        if (!date) return '-';
        const d = date.toDate ? date.toDate() : new Date(date);
        return d.toLocaleString('id-ID', {
            day: '2-digit', month: 'short', year: 'numeric',
            hour: '2-digit', minute: '2-digit'
        });
    },
    
    formatDateOnly(date) {
        if (!date) return '-';
        const d = date.toDate ? date.toDate() : new Date(date);
        return d.toLocaleDateString('id-ID');
    },
    
    showLoading() {
        const loading = document.createElement('div');
        loading.className = 'loading';
        loading.innerHTML = `<div class="loading-spinner"></div><div data-translate="loading">Loading...</div>`;
        document.body.appendChild(loading);
        return loading;
    },
    
    hideLoading(loading) {
        if (loading && loading.parentElement) loading.remove();
    },
    
    el(id) { return document.getElementById(id); },
    
    // Get translation
    t(key) {
        return window.getTranslation ? window.getTranslation(key) : key;
    },
    
    // Generate invoice HTML with all features
    generateInvoiceHTML(order, settings) {
        const customer = order.customer || {};
        const items = order.items || [];
        const orderNumber = order.orderNumber || order.id;
        const taxSettings = settings.tax || { percentage: 10, name: 'PPN', serviceFee: 5, serviceName: 'Service Charge' };
        const generalSettings = settings.general || {};
        
        let itemsHTML = '';
        let subtotal = 0;
        let totalDiscount = 0;
        
        items.forEach(item => {
            const itemPrice = item.price || 0;
            const itemQuantity = item.quantity || 1;
            const itemDiscount = item.discount || 0;
            const discountType = item.discountType || 'percentage';
            
            // Calculate price after discount
            let finalPrice = itemPrice;
            let itemDiscountAmount = 0;
            
            if (itemDiscount > 0) {
                if (discountType === 'percentage') {
                    itemDiscountAmount = itemPrice * itemDiscount / 100;
                } else {
                    itemDiscountAmount = itemDiscount;
                }
                finalPrice = itemPrice - itemDiscountAmount;
            }
            
            const itemTotal = finalPrice * itemQuantity;
            subtotal += itemTotal;
            totalDiscount += itemDiscountAmount * itemQuantity;
            
            itemsHTML += `
                <tr>
                    <td style="padding: 8px; border-bottom: 1px solid #eee;">${item.name}</td>
                    <td style="padding: 8px; border-bottom: 1px solid #eee; text-align: center;">${itemQuantity}</td>
                    <td style="padding: 8px; border-bottom: 1px solid #eee; text-align: right;">
                        ${itemDiscount > 0 ? `
                            <div style="text-decoration: line-through; color: #999; font-size: 0.9em;">
                                ${this.formatCurrency(itemPrice)}
                            </div>
                            <div style="color: #d9534f; font-weight: bold;">
                                ${this.formatCurrency(finalPrice)}
                            </div>
                        ` : this.formatCurrency(itemPrice)}
                    </td>
                    <td style="padding: 8px; border-bottom: 1px solid #eee; text-align: right;">
                        ${this.formatCurrency(itemTotal)}
                        ${itemDiscount > 0 ? `<div style="color: #5cb85c; font-size: 0.9em;">-${this.formatCurrency(itemDiscountAmount * itemQuantity)}</div>` : ''}
                    </td>
                </tr>
            `;
        });
        
        const taxAmount = subtotal * (taxSettings.percentage || 0) / 100;
        const serviceFeeAmount = subtotal * (taxSettings.serviceFee || 0) / 100;
        const total = subtotal + taxAmount + serviceFeeAmount;
        
        const storeName = generalSettings.name || 'THE GRAND BISTRO';
        const storeAddress = generalSettings.address || 'Jl. Kemang Raya No. 123, Jakarta Selatan';
        const storePhone = generalSettings.phone || '(021) 1234-5678';
        const storeEmail = generalSettings.email || 'rsvp@grandbistro.com';
        
        return `
            <div class="invoice-preview" style="font-family: Arial, sans-serif; color: #333;">
                <div style="text-align: center; border-bottom: 2px solid #d4af37; padding-bottom: 15px; margin-bottom: 20px;">
                    <h1 style="margin: 0; color: #d4af37;">${storeName}</h1>
                    <p style="margin: 5px 0; color: #666;">${storeAddress}</p>
                    <p style="margin: 5px 0; color: #666;">Telp: ${storePhone} | Email: ${storeEmail}</p>
                </div>
                
                <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                    <div>
                        <h3 style="margin: 0; color: #333;">INVOICE</h3>
                        <p style="margin: 5px 0;"><strong>Invoice No:</strong> ${orderNumber}</p>
                        <p style="margin: 5px 0;"><strong>Date:</strong> ${this.formatDate(order.timestamp)}</p>
                        <p style="margin: 5px 0;"><strong>Status:</strong> <span style="background: #28a745; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.8em;">${order.status?.toUpperCase() || 'PENDING'}</span></p>
                        <p style="margin: 5px 0;"><strong>Method:</strong> ${order.method || 'Dine-In'}</p>
                    </div>
                    <div>
                        <h3 style="margin: 0; color: #333;">BILL TO:</h3>
                        <p style="margin: 5px 0;"><strong>${customer.name || 'Customer'}</strong></p>
                        <p style="margin: 5px 0;">${customer.email || ''}</p>
                        <p style="margin: 5px 0;">${customer.phone || ''}</p>
                        ${customer.table ? `<p style="margin: 5px 0;"><strong>Table:</strong> ${customer.table}</p>` : ''}
                    </div>
                </div>
                
                <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
                    <thead>
                        <tr style="background: #f8f9fa; border-bottom: 2px solid #dee2e6;">
                            <th style="padding: 10px; text-align: left;">Item</th>
                            <th style="padding: 10px; text-align: center;">Qty</th>
                            <th style="padding: 10px; text-align: right;">Price</th>
                            <th style="padding: 10px; text-align: right;">Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${itemsHTML}
                    </tbody>
                </table>
                
                <div style="border-top: 2px solid #d4af37; padding-top: 15px; margin-top: 20px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>Subtotal:</span>
                        <span>${this.formatCurrency(subtotal)}</span>
                    </div>
                    
                    ${totalDiscount > 0 ? `
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px; color: #5cb85c;">
                            <span>Total Discount:</span>
                            <span>-${this.formatCurrency(totalDiscount)}</span>
                        </div>
                    ` : ''}
                    
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>${taxSettings.name || 'Tax'} (${taxSettings.percentage || 0}%):</span>
                        <span>${this.formatCurrency(taxAmount)}</span>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>${taxSettings.serviceName || 'Service Charge'} (${taxSettings.serviceFee || 0}%):</span>
                        <span>${this.formatCurrency(serviceFeeAmount)}</span>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; font-size: 1.2em; font-weight: bold; margin-top: 10px; padding-top: 10px; border-top: 1px solid #dee2e6;">
                        <span>TOTAL:</span>
                        <span>${this.formatCurrency(total)}</span>
                    </div>
                </div>
                
                ${order.paymentProof ? `
                    <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 5px;">
                        <h4 style="margin: 0 0 10px 0; color: #333;">Payment Information</h4>
                        <p style="margin: 5px 0;"><strong>Payment Proof:</strong> <a href="${order.paymentProof}" target="_blank" style="color: #d4af37;">View Proof</a></p>
                        ${order.paymentBank ? `<p style="margin: 5px 0;"><strong>Bank:</strong> ${order.paymentBank}</p>` : ''}
                        ${order.paymentDate ? `<p style="margin: 5px 0;"><strong>Payment Date:</strong> ${order.paymentDate}</p>` : ''}
                    </div>
                ` : ''}
                
                <div style="margin-top: 30px; padding-top: 15px; border-top: 1px dashed #ccc; text-align: center; font-size: 0.8em; color: #666;">
                    <p style="margin: 5px 0;">Thank you for dining with us!</p>
                    <p style="margin: 5px 0;">This is a computer-generated invoice. No signature required.</p>
                    <p style="margin: 5px 0;">For any questions, please contact ${storePhone} or ${storeEmail}</p>
                </div>
            </div>
        `;
    },
    
    // Generate order number
    generateOrderNumber() {
        const date = new Date();
        const year = date.getFullYear().toString().substr(-2);
        const month = (date.getMonth() + 1).toString().padStart(2, '0');
        const day = date.getDate().toString().padStart(2, '0');
        const random = Math.floor(1000 + Math.random() * 9000);
        return `GB${year}${month}${day}${random}`;
    },
    
    // Download data as file
    downloadFile(data, filename, type) {
        const blob = new Blob([data], { type });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    },
    
    // Calculate price with discount
    calculatePriceWithDiscount(price, discount, discountType) {
        if (!discount || discount <= 0) return price;
        
        if (discountType === 'percentage') {
            return price - (price * discount / 100);
        } else {
            return price - discount;
        }
    },
    
    // Get discount amount
    getDiscountAmount(price, discount, discountType) {
        if (!discount || discount <= 0) return 0;
        
        if (discountType === 'percentage') {
            return price * discount / 100;
        } else {
            return discount;
        }
    }
};

// ===== FIREBASE INITIALIZATION =====
async function initializeFirebase() {
    try {
        firebase.initializeApp(firebaseConfig);
        state.db = firebase.firestore();
        state.auth = firebase.auth();
        state.storage = firebase.storage();
        
        state.db.settings({ timestampsInSnapshots: true });
        console.log('Firebase initialized successfully');
        return true;
    } catch (error) {
        console.error('Firebase initialization error:', error);
        utils.showNotification('Error initializing database', 'error');
        return false;
    }
}

// ===== AUTHENTICATION =====
const auth = {
    async init() {
        const firebaseReady = await initializeFirebase();
        if (!firebaseReady) return;
        
        utils.el('loginBtn').addEventListener('click', () => this.login());
        utils.el('signupBtn').addEventListener('click', () => this.signup());
        utils.el('forgotBtn').addEventListener('click', () => this.forgotPassword());
        
        ['loginEmail', 'loginPass', 'signupName', 'signupEmail', 'signupPass', 'signupConfirm', 'forgotEmail'].forEach(id => {
            utils.el(id)?.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    if (id.startsWith('login')) this.login();
                    else if (id.startsWith('signup')) this.signup();
                    else if (id.startsWith('forgot')) this.forgotPassword();
                }
            });
        });
        
        this.checkAuthState();
    },
    
    checkAuthState() {
        state.auth.onAuthStateChanged((user) => {
            if (user) {
                this.handleLoginSuccess(user);
            }
        });
    },
    
    async login() {
        const email = utils.el('loginEmail').value.trim();
        const password = utils.el('loginPass').value.trim();
        
        if (!email || !password) {
            utils.showNotification(utils.t('email') + ' dan ' + utils.t('password') + ' harus diisi', 'error');
            return;
        }
        
        const loading = utils.showLoading();
        
        try {
            const userCredential = await state.auth.signInWithEmailAndPassword(email, password);
            const user = userCredential.user;
            
            const adminDoc = await state.db.collection('admins').doc(user.uid).get();
            
            if (!adminDoc.exists) {
                await state.auth.signOut();
                throw new Error('User is not an admin');
            }
            
            this.handleLoginSuccess(user);
            utils.hideLoading(loading);
            
        } catch (error) {
            utils.hideLoading(loading);
            console.error('Login error:', error);
            
            let message = utils.t('loginFailed');
            switch(error.code) {
                case 'auth/user-not-found':
                    message = utils.t('userNotFound');
                    break;
                case 'auth/wrong-password':
                    message = utils.t('wrongPassword');
                    break;
                case 'auth/invalid-email':
                    message = utils.t('invalidEmail');
                    break;
                default:
                    message = error.message;
            }
            
            utils.showNotification(message, 'error');
        }
    },
    
    async signup() {
        const name = utils.el('signupName').value.trim();
        const email = utils.el('signupEmail').value.trim();
        const password = utils.el('signupPass').value.trim();
        const confirm = utils.el('signupConfirm').value.trim();
        
        if (!name || !email || !password || !confirm) {
            utils.showNotification(utils.t('allFieldsRequired'), 'error');
            return;
        }
        
        if (password.length < 6) {
            utils.showNotification(utils.t('passwordMinLength'), 'error');
            return;
        }
        
        if (password !== confirm) {
            utils.showNotification(utils.t('passwordMismatch'), 'error');
            return;
        }
        
        const loading = utils.showLoading();
        
        try {
            const userCredential = await state.auth.createUserWithEmailAndPassword(email, password);
            const user = userCredential.user;
            
            await state.db.collection('admins').doc(user.uid).set({
                uid: user.uid,
                email: user.email,
                name: name,
                role: 'admin',
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                active: true
            });
            
            utils.showNotification(utils.t('accountCreated'), 'success');
            
            utils.el('signupName').value = '';
            utils.el('signupEmail').value = '';
            utils.el('signupPass').value = '';
            utils.el('signupConfirm').value = '';
            
            showForm('login');
            
        } catch (error) {
            console.error('Signup error:', error);
            
            let message = utils.t('signupFailed');
            switch(error.code) {
                case 'auth/email-already-in-use':
                    message = utils.t('emailAlreadyUsed');
                    break;
                case 'auth/invalid-email':
                    message = utils.t('invalidEmail');
                    break;
                case 'auth/weak-password':
                    message = utils.t('weakPassword');
                    break;
                default:
                    message = error.message;
            }
            
            utils.showNotification(message, 'error');
        } finally {
            utils.hideLoading(loading);
        }
    },
    
    async forgotPassword() {
        const email = utils.el('forgotEmail').value.trim();
        
        if (!email) {
            utils.showNotification(utils.t('emailRequired'), 'error');
            return;
        }
        
        const loading = utils.showLoading();
        
        try {
            await state.auth.sendPasswordResetEmail(email);
            utils.showNotification(utils.t('resetEmailSent'), 'success');
            utils.el('forgotEmail').value = '';
        } catch (error) {
            console.error('Forgot password error:', error);
            utils.showNotification(utils.t('resetEmailFailed'), 'error');
        } finally {
            utils.hideLoading(loading);
        }
    },
    
    async handleLoginSuccess(user) {
        try {
            const adminDoc = await state.db.collection('admins').doc(user.uid).get();
            
            if (!adminDoc.exists) {
                await state.auth.signOut();
                throw new Error('User is not an admin');
            }
            
            const adminData = adminDoc.data();
            
            state.user = {
                uid: user.uid,
                email: user.email,
                name: adminData.name,
                role: adminData.role
            };
            
            localStorage.setItem('admin_auth', JSON.stringify({
                uid: user.uid,
                email: user.email,
                name: adminData.name,
                timestamp: Date.now()
            }));
            
            this.showAdmin();
            await data.loadInitialData();
            
            utils.showNotification(utils.t('welcomeBack') + ', ' + adminData.name + '!', 'success');
            
        } catch (error) {
            console.error('Error getting admin data:', error);
            utils.showNotification(utils.t('loadAdminDataFailed'), 'error');
            await this.logout();
        }
    },
    
    showAdmin() {
        utils.el('loginArea').style.display = 'none';
        utils.el('adminContent').style.display = 'block';
        
        if (state.user) {
            utils.el('adminName').textContent = state.user.name;
            utils.el('adminRole').textContent = state.user.role.toUpperCase();
        }
        
        // Update UI text with current language
        if (window.updateUIText) {
            window.updateUIText();
        }
    },
    
    async logout() {
        if (confirm(utils.t('confirmLogout'))) {
            try {
                await state.auth.signOut();
                state.user = null;
                localStorage.removeItem('admin_auth');
                location.reload();
            } catch (error) {
                console.error('Logout error:', error);
                utils.showNotification(utils.t('logoutFailed'), 'error');
            }
        }
    }
};

// ===== DATA MANAGEMENT =====
const data = {
    async loadInitialData() {
        const loading = utils.showLoading();
        try {
            await Promise.all([
                this.loadOrders(),
                this.loadMenu(),
                this.loadBankAccounts(),
                this.loadSettings(),
                this.loadStats()
            ]);
            chart.init();
            log.render();
            this.loadRecentOrders();
            this.loadPendingPayments();
            this.updateTaxPreview();
        } catch (error) {
            console.error('Load data error:', error);
            utils.showNotification(utils.t('loadDataFailed'), 'error');
        } finally {
            utils.hideLoading(loading);
        }
    },
    
    async loadSettings() {
        try {
            const snapshot = await state.db.collection('settings').get();
            
            state.settings = {
                general: {},
                tax: { percentage: 10, name: 'PPN', serviceFee: 5, serviceName: 'Service Charge' },
                invoice: {},
                email: {}
            };
            
            snapshot.forEach(doc => {
                const data = doc.data();
                switch(doc.id) {
                    case 'general':
                        state.settings.general = data;
                        utils.el('restaurantName').value = data.name || '';
                        utils.el('restaurantPhone').value = data.phone || '';
                        utils.el('restaurantEmail').value = data.email || '';
                        utils.el('restaurantAddress').value = data.address || '';
                        utils.el('openingTime').value = data.openingTime || '';
                        utils.el('closingTime').value = data.closingTime || '';
                        utils.el('restaurantWebsite').value = data.website || '';
                        utils.el('restaurantInstagram').value = data.instagram || '';
                        utils.el('restaurantFacebook').value = data.facebook || '';
                        utils.el('restaurantDescription').value = data.description || '';
                        
                        // Update preview
                        utils.el('previewStoreName').textContent = data.name || 'THE GRAND BISTRO';
                        utils.el('previewStoreAddress').textContent = data.address || 'Jl. Kemang Raya No. 123, Jakarta';
                        utils.el('previewStorePhone').textContent = data.phone ? `Telp: ${data.phone}` : 'Telp: (021) 1234-5678';
                        break;
                        
                    case 'tax':
                        state.settings.tax = data;
                        utils.el('taxName').value = data.name || 'PPN';
                        utils.el('taxPercentage').value = data.percentage || 10;
                        utils.el('serviceFeeName').value = data.serviceName || 'Service Charge';
                        utils.el('serviceFeePercentage').value = data.serviceFee || 5;
                        break;
                        
                    case 'invoice':
                        state.settings.invoice = data;
                        utils.el('invoicePrefix').value = data.prefix || 'GB';
                        utils.el('invoiceFooter').value = data.footer || 'Thank you for dining with us!';
                        utils.el('invoiceTerms').value = data.terms || '';
                        utils.el('logoUrl').value = data.logoUrl || '';
                        utils.el('primaryColor').value = data.primaryColor || '#d4af37';
                        utils.el('previewInvoiceFooter').textContent = data.footer || 'Thank you for dining with us!';
                        break;
                        
                    case 'email_templates':
                        state.settings.email = data;
                        break;
                }
            });
            
        } catch (error) {
            console.error('Load settings error:', error);
        }
    },
    
    async loadOrders() {
        try {
            const snapshot = await state.db.collection('orders')
                .orderBy('timestamp', 'desc')
                .limit(100)
                .get();
            
            state.allOrders = [];
            snapshot.forEach(doc => {
                state.allOrders.push({
                    id: doc.id,
                    ...doc.data()
                });
            });
            
            state.orders = state.allOrders;
            render.orders();
            
        } catch (error) {
            console.error('Load orders error:', error);
            state.allOrders = [];
            state.orders = [];
            render.orders();
        }
    },
    
    async loadAllOrders() {
        try {
            let query = state.db.collection('orders').orderBy('timestamp', 'desc');
            
            const dateFilter = utils.el('filterDate')?.value || '';
            const statusFilter = utils.el('filterStatus')?.value || 'all';
            
            if (dateFilter) {
                const startDate = new Date(dateFilter);
                startDate.setHours(0, 0, 0, 0);
                const endDate = new Date(dateFilter);
                endDate.setHours(23, 59, 59, 999);
                
                query = query.where('timestamp', '>=', startDate)
                            .where('timestamp', '<=', endDate);
            }
            
            if (statusFilter !== 'all') {
                query = query.where('status', '==', statusFilter);
            }
            
            const snapshot = await query.limit(100).get();
            
            state.allOrders = [];
            snapshot.forEach(doc => {
                state.allOrders.push({
                    id: doc.id,
                    ...doc.data()
                });
            });
            
            state.orders = state.allOrders;
            render.orders();
            
        } catch (error) {
            console.error('Load orders error:', error);
        }
    },
    
    async loadRecentOrders() {
        try {
            const snapshot = await state.db.collection('orders')
                .orderBy('timestamp', 'desc')
                .limit(10)
                .get();
            
            const recentOrders = [];
            snapshot.forEach(doc => {
                recentOrders.push({
                    id: doc.id,
                    ...doc.data()
                });
            });
            
            render.recentOrders(recentOrders);
            
        } catch (error) {
            console.error('Load recent orders error:', error);
        }
    },
    
    async loadMenu() {
        try {
            const snapshot = await state.db.collection('menu')
                .where('active', '==', true)
                .get();
            
            state.menu = [];
            snapshot.forEach(doc => {
                state.menu.push({
                    id: doc.id,
                    ...doc.data()
                });
            });
            
            render.menu();
            
        } catch (error) {
            console.error('Load menu error:', error);
            state.menu = [];
            render.menu();
        }
    },
    
    async loadBankAccounts() {
        try {
            const snapshot = await state.db.collection('bank_accounts')
                .where('active', '==', true)
                .get();
            
            state.bankAccounts = [];
            snapshot.forEach(doc => {
                state.bankAccounts.push({
                    id: doc.id,
                    ...doc.data()
                });
            });
            
            render.bankAccounts();
            
        } catch (error) {
            console.error('Load bank accounts error:', error);
        }
    },
    
    async loadStats() {
        try {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            
            const firstDayOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
            
            // Get today's paid orders
            const todaySnapshot = await state.db.collection('orders')
                .where('timestamp', '>=', today)
                .where('timestamp', '<', tomorrow)
                .where('status', '==', 'paid')
                .get();
            
            let todayIncome = 0;
            todaySnapshot.forEach(doc => {
                const order = doc.data();
                todayIncome += order.total || 0;
            });
            
            // Get this month's paid orders
            const monthSnapshot = await state.db.collection('orders')
                .where('timestamp', '>=', firstDayOfMonth)
                .where('timestamp', '<', tomorrow)
                .where('status', '==', 'paid')
                .get();
            
            let monthIncome = 0;
            monthSnapshot.forEach(doc => {
                const order = doc.data();
                monthIncome += order.total || 0;
            });
            
            // Get total orders count
            const totalSnapshot = await state.db.collection('orders').get();
            
            // Get pending payments count
            const pendingSnapshot = await state.db.collection('orders')
                .where('status', '==', 'waiting_payment')
                .get();
            
            state.stats = {
                today: todayIncome,
                month: monthIncome,
                total: totalSnapshot.size,
                pending: pendingSnapshot.size
            };
            
            render.stats();
            
        } catch (error) {
            console.error('Load stats error:', error);
            state.stats = { today: 0, month: 0, total: 0, pending: 0 };
            render.stats();
        }
    },
    
    async loadBlockedDates() {
        try {
            const snapshot = await state.db.collection('blocked_dates').get();
            const blockedDates = [];
            snapshot.forEach(doc => {
                blockedDates.push({
                    id: doc.id,
                    ...doc.data()
                });
            });
            render.blockedDates(blockedDates);
        } catch (error) {
            console.error('Load blocked dates error:', error);
        }
    },
    
    async loadPendingPayments() {
        try {
            const snapshot = await state.db.collection('orders')
                .where('status', '==', 'waiting_payment')
                .orderBy('timestamp', 'desc')
                .get();
            
            const pendingPayments = [];
            snapshot.forEach(doc => {
                pendingPayments.push({
                    id: doc.id,
                    ...doc.data()
                });
            });
            
            render.pendingPayments(pendingPayments);
            
        } catch (error) {
            console.error('Load pending payments error:', error);
        }
    },
    
    async saveMenu() {
        const menuId = utils.el('menuId').value;
        const item = {
            name: utils.el('mName').value.trim(),
            price: parseInt(utils.el('mPrice').value) || 0,
            cogs: parseInt(utils.el('mCogs').value) || 0,
            category: utils.el('mCat').value.trim(),
            stock: parseInt(utils.el('mStock').value) || 0,
            discountType: utils.el('mDiscountType').value || '',
            discount: parseFloat(utils.el('mDiscountValue').value) || 0,
            image: utils.el('mImg').value.trim(),
            description: utils.el('mDesc').value.trim(),
            active: true,
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        };
        
        if (!item.name || !item.price) {
            utils.showNotification(utils.t('namePriceRequired'), 'error');
            return;
        }
        
        const loading = utils.showLoading();
        
        try {
            if (menuId) {
                // Update existing menu
                await state.db.collection('menu').doc(menuId).update(item);
                utils.showNotification(utils.t('menuUpdated'), 'success');
                log.add(`Memperbarui menu: ${item.name}`);
            } else {
                // Add new menu
                item.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                await state.db.collection('menu').add(item);
                utils.showNotification(utils.t('menuAdded'), 'success');
                log.add(`Menambah menu: ${item.name}`);
            }
            
            await this.loadMenu();
            
            // Clear form
            utils.el('menuId').value = '';
            utils.el('mName').value = '';
            utils.el('mPrice').value = '';
            utils.el('mCogs').value = '';
            utils.el('mCat').value = '';
            utils.el('mStock').value = '999';
            utils.el('mDiscountType').value = '';
            utils.el('mDiscountValue').value = '';
            utils.el('mImg').value = '';
            utils.el('mDesc').value = '';
            
        } catch (error) {
            console.error('Save menu error:', error);
            utils.showNotification(utils.t('saveMenuFailed'), 'error');
        } finally {
            utils.hideLoading(loading);
        }
    },
    
    async editMenu(menuId) {
        const menuItem = state.menu.find(m => m.id === menuId);
        if (!menuItem) return;
        
        utils.el('menuId').value = menuId;
        utils.el('mName').value = menuItem.name;
        utils.el('mPrice').value = menuItem.price;
        utils.el('mCogs').value = menuItem.cogs || 0;
        utils.el('mCat').value = menuItem.category || '';
        utils.el('mStock').value = menuItem.stock || 0;
        utils.el('mDiscountType').value = menuItem.discountType || '';
        utils.el('mDiscountValue').value = menuItem.discount || 0;
        utils.el('mImg').value = menuItem.image || '';
        utils.el('mDesc').value = menuItem.description || '';
    },
    
    async deleteMenu(menuId) {
        if (!confirm(utils.t('deleteConfirm'))) return;
        
        const loading = utils.showLoading();
        
        try {
            await state.db.collection('menu').doc(menuId).update({
                active: false,
                deletedAt: firebase.firestore.FieldValue.serverTimestamp()
            });
            
            await this.loadMenu();
            utils.showNotification(utils.t('deleteSuccess'), 'success');
            
        } catch (error) {
            console.error('Delete menu error:', error);
            utils.showNotification(utils.t('deleteFailed'), 'error');
        } finally {
            utils.hideLoading(loading);
        }
    },
    
    async saveGeneralSettings() {
        const settings = {
            name: utils.el('restaurantName').value.trim(),
            phone: utils.el('restaurantPhone').value.trim(),
            email: utils.el('restaurantEmail').value.trim(),
            address: utils.el('restaurantAddress').value.trim(),
            openingTime: utils.el('openingTime').value.trim(),
            closingTime: utils.el('closingTime').value.trim(),
            website: utils.el('restaurantWebsite').value.trim(),
            instagram: utils.el('restaurantInstagram').value.trim(),
            facebook: utils.el('restaurantFacebook').value.trim(),
            description: utils.el('restaurantDescription').value.trim(),
            updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
            updatedBy: state.user.name
        };
        
        const loading = utils.showLoading();
        
        try {
            await state.db.collection('settings').doc('general').set(settings, { merge: true });
            state.settings.general = settings;
            
            // Update preview
            utils.el('previewStoreName').textContent = settings.name || 'THE GRAND BISTRO';
            utils.el('previewStoreAddress').textContent = settings.address || 'Jl. Kemang Raya No. 123, Jakarta';
            utils.el('previewStorePhone').textContent = settings.phone ? `Telp: ${settings.phone}` : 'Telp: (021) 1234-5678';
            
            utils.showNotification(utils.t('saveSuccess'), 'success');
            log.add('Memperbarui informasi toko');
        } catch (error) {
            console.error('Save settings error:', error);
            utils.showNotification(utils.t('saveFailed'), 'error');
        } finally {
            utils.hideLoading(loading);
        }
    },
    
    async saveTaxSettings() {
        const taxSettings = {
            name: utils.el('taxName').value.trim() || 'PPN',
            percentage: parseFloat(utils.el('taxPercentage').value) || 0,
            serviceName: utils.el('serviceFeeName').value.trim() || 'Service Charge',
            serviceFee: parseFloat(utils.el('serviceFeePercentage').value) || 0,
            updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
            updatedBy: state.user.name
        };
        
        const loading = utils.showLoading();
        
        try {
            await state.db.collection('settings').doc('tax').set(taxSettings, { merge: true });
            state.settings.tax = taxSettings;
            
            // Update preview
            this.updateTaxPreview();
            
            utils.showNotification(utils.t('saveSuccess'), 'success');
            log.add('Memperbarui pengaturan tax & service fee');
        } catch (error) {
            console.error('Save tax settings error:', error);
            utils.showNotification(utils.t('saveFailed'), 'error');
        } finally {
            utils.hideLoading(loading);
        }
    },
    
    async saveInvoiceSettings() {
        const invoiceSettings = {
            prefix: utils.el('invoicePrefix').value.trim() || 'GB',
            footer: utils.el('invoiceFooter').value.trim() || 'Thank you for dining with us!',
            terms: utils.el('invoiceTerms').value.trim(),
            logoUrl: utils.el('logoUrl').value.trim(),
            primaryColor: utils.el('primaryColor').value,
            updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
            updatedBy: state.user.name
        };
        
        const loading = utils.showLoading();
        
        try {
            await state.db.collection('settings').doc('invoice').set(invoiceSettings, { merge: true });
            state.settings.invoice = invoiceSettings;
            
            // Update preview
            utils.el('previewInvoiceFooter').textContent = invoiceSettings.footer;
            
            utils.showNotification(utils.t('saveSuccess'), 'success');
            log.add('Memperbarui template invoice');
        } catch (error) {
            console.error('Save invoice settings error:', error);
            utils.showNotification(utils.t('saveFailed'), 'error');
        } finally {
            utils.hideLoading(loading);
        }
    },
    
    async updateTaxPreview() {
        const taxSettings = state.settings.tax;
        const subtotal = 100000; // Example subtotal
        
        utils.el('previewTaxPercent').textContent = `${taxSettings.percentage || 0}%`;
        utils.el('previewServicePercent').textContent = `${taxSettings.serviceFee || 0}%`;
        
        const taxAmount = subtotal * (taxSettings.percentage || 0) / 100;
        const serviceAmount = subtotal * (taxSettings.serviceFee || 0) / 100;
        const total = subtotal + taxAmount + serviceAmount;
        
        utils.el('previewSubtotal').textContent = utils.formatCurrency(subtotal);
        utils.el('previewTaxAmount').textContent = utils.formatCurrency(taxAmount);
        utils.el('previewServiceAmount').textContent = utils.formatCurrency(serviceAmount);
        utils.el('previewTotal').textContent = utils.formatCurrency(total);
    },
    
    async updateOrderStatus(orderId, status) {
        if (!confirm(utils.t('confirmAction'))) return;
        
        const loading = utils.showLoading();
        
        try {
            await state.db.collection('orders').doc(orderId).update({
                status: status,
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            });
            
            await this.loadOrders();
            await this.loadStats();
            await this.loadRecentOrders();
            await this.loadPendingPayments();
            
            if (status === 'paid') {
                await this.sendInvoice(orderId);
            }
            
            utils.showNotification(utils.t('updateSuccess'), 'success');
            log.add(`Mengubah status pesanan ${orderId} menjadi ${status}`);
            
        } catch (error) {
            console.error('Update status error:', error);
            utils.showNotification(utils.t('updateFailed'), 'error');
        } finally {
            utils.hideLoading(loading);
        }
    },
    
    async viewPaymentProof(orderId) {
        try {
            const orderDoc = await state.db.collection('orders').doc(orderId).get();
            const order = orderDoc.data();
            
            if (!order.paymentProof) {
                utils.showNotification(utils.t('noPaymentProof'), 'warning');
                return;
            }
            
            state.currentOrderId = orderId;
            
            utils.el('paymentProofContent').innerHTML = `
                <div style="margin-bottom: 20px;">
                    <h4 style="color: var(--gold);">${utils.t('detailOrder')}</h4>
                    <p><strong>${utils.t('orderId')}:</strong> ${order.orderNumber || orderId}</p>
                    <p><strong>${utils.t('customer')}:</strong> ${order.customer?.name || ''}</p>
                    <p><strong>${utils.t('total')}:</strong> ${utils.formatCurrency(order.total || 0)}</p>
                    <p><strong>${utils.t('time')}:</strong> ${utils.formatDate(order.timestamp)}</p>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <h4 style="color: var(--gold);">${utils.t('proof')}</h4>
                    <div class="proof-image-container">
                        <img src="${order.paymentProof}" alt="${utils.t('proof')}" class="proof-image">
                    </div>
                </div>
                
                <div>
                    <h4 style="color: var(--gold);">${utils.t('paymentInfo')}</h4>
                    <p><strong>${utils.t('bank')}:</strong> ${order.paymentBank || '-'}</p>
                    <p><strong>${utils.t('accountNumber')}:</strong> ${order.paymentAccount || '-'}</p>
                    <p><strong>${utils.t('senderName')}:</strong> ${order.paymentSender || '-'}</p>
                    <p><strong>${utils.t('amount')}:</strong> ${utils.formatCurrency(order.paymentAmount || order.total || 0)}</p>
                    <p><strong>${utils.t('paymentDate')}:</strong> ${order.paymentDate || '-'}</p>
                </div>
            `;
            
            utils.el('paymentProofModal').style.display = 'flex';
            
        } catch (error) {
            console.error('View payment proof error:', error);
            utils.showNotification(utils.t('loadPaymentProofFailed'), 'error');
        }
    },
    
    async verifyPayment(approved) {
        if (!state.currentOrderId) return;
        
        const loading = utils.showLoading();
        
        try {
            const status = approved ? 'paid' : 'pending';
            const message = approved ? utils.t('paymentAccepted') : utils.t('paymentRejected');
            
            await state.db.collection('orders').doc(state.currentOrderId).update({
                status: status,
                paymentVerified: approved,
                paymentVerifiedBy: state.user.name,
                paymentVerifiedAt: firebase.firestore.FieldValue.serverTimestamp(),
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            });
            
            await this.loadOrders();
            await this.loadStats();
            await this.loadRecentOrders();
            await this.loadPendingPayments();
            
            if (approved) {
                await this.sendInvoice(state.currentOrderId);
            }
            
            utils.showNotification(message, 'success');
            log.add(`${message} untuk order ${state.currentOrderId}`);
            
            closeModal('paymentProofModal');
            
        } catch (error) {
            console.error('Verify payment error:', error);
            utils.showNotification(utils.t('verifyPaymentFailed'), 'error');
        } finally {
            utils.hideLoading(loading);
            state.currentOrderId = null;
        }
    },
    
    async sendInvoice(orderId) {
        try {
            const orderDoc = await state.db.collection('orders').doc(orderId).get();
            const order = orderDoc.data();
            
            // Generate invoice HTML
            const invoiceHTML = utils.generateInvoiceHTML(order, state.settings);
            
            // Save invoice to database
            await state.db.collection('invoices').add({
                orderId: orderId,
                orderNumber: order.orderNumber,
                customerEmail: order.customer.email,
                customerName: order.customer.name,
                invoiceHtml: invoiceHTML,
                total: order.total,
                sentAt: firebase.firestore.FieldValue.serverTimestamp(),
                sentBy: state.user.name
            });
            
            // Send email (simulated)
            console.log(`Sending invoice to ${order.customer.email}`);
            
            utils.showNotification(utils.t('invoiceSent'), 'success');
            
        } catch (error) {
            console.error('Send invoice error:', error);
            utils.showNotification(utils.t('sendInvoiceFailed'), 'error');
        }
    },
    
    async blockDateAction() {
        const date = utils.el('blockDate').value;
        const reason = utils.el('blockReason').value;
        
        if (!date) {
            utils.showNotification(utils.t('selectDate'), 'error');
            return;
        }
        
        const loading = utils.showLoading();
        
        try {
            await state.db.collection('blocked_dates').add({
                date: date,
                reason: reason,
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                createdBy: state.user.name
            });
            
            await this.loadBlockedDates();
            utils.el('blockDate').value = '';
            utils.showNotification(utils.t('dateBlocked'), 'success');
            log.add(`Memblokir tanggal ${date}: ${reason}`);
            
        } catch (error) {
            utils.showNotification(utils.t('blockFailed'), 'error');
        } finally {
            utils.hideLoading(loading);
        }
    },
    
    async addBankAccount() {
        const account = {
            bankName: utils.el('bankName').value.trim(),
            accountName: utils.el('accountName').value.trim(),
            accountNumber: utils.el('accountNumber').value.trim(),
            active: true,
            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
            createdBy: state.user.name
        };
        
        if (!account.bankName || !account.accountName || !account.accountNumber) {
            utils.showNotification(utils.t('allFieldsRequired'), 'error');
            return;
        }
        
        const loading = utils.showLoading();
        
        try {
            await state.db.collection('bank_accounts').add(account);
            
            await this.loadBankAccounts();
            utils.showNotification(utils.t('accountAdded'), 'success');
            
            // Clear form
            utils.el('bankName').value = '';
            utils.el('accountName').value = '';
            utils.el('accountNumber').value = '';
            
            log.add(`Menambah rekening bank: ${account.bankName} - ${account.accountNumber}`);
            
        } catch (error) {
            console.error('Add bank account error:', error);
            utils.showNotification(utils.t('addAccountFailed'), 'error');
        } finally {
            utils.hideLoading(loading);
        }
    },
    
    async deleteBankAccount(accountId) {
        if (!confirm(utils.t('deleteConfirm'))) return;
        
        const loading = utils.showLoading();
        
        try {
            await state.db.collection('bank_accounts').doc(accountId).update({
                active: false,
                deletedAt: firebase.firestore.FieldValue.serverTimestamp()
            });
            
            await this.loadBankAccounts();
            utils.showNotification(utils.t('deleteSuccess'), 'success');
            
        } catch (error) {
            console.error('Delete bank account error:', error);
            utils.showNotification(utils.t('deleteFailed'), 'error');
        } finally {
            utils.hideLoading(loading);
        }
    },
    
    async viewOrderDetails(orderId) {
        try {
            const orderDoc = await state.db.collection('orders').doc(orderId).get();
            const order = orderDoc.data();
            
            state.currentOrderId = orderId;
            
            const customer = order.customer || {};
            const items = order.items || [];
            
            let itemsHTML = '';
            let subtotal = 0;
            let totalDiscount = 0;
            
            items.forEach(item => {
                const itemPrice = item.price || 0;
                const itemQuantity = item.quantity || 1;
                const itemDiscount = item.discount || 0;
                const discountType = item.discountType || 'percentage';
                
                // Calculate price after discount
                let finalPrice = itemPrice;
                let itemDiscountAmount = 0;
                
                if (itemDiscount > 0) {
                    if (discountType === 'percentage') {
                        itemDiscountAmount = itemPrice * itemDiscount / 100;
                    } else {
                        itemDiscountAmount = itemDiscount;
                    }
                    finalPrice = itemPrice - itemDiscountAmount;
                }
                
                const itemTotal = finalPrice * itemQuantity;
                subtotal += itemTotal;
                totalDiscount += itemDiscountAmount * itemQuantity;
                
                itemsHTML += `
                    <tr>
                        <td>${item.name}</td>
                        <td style="text-align: center;">${itemQuantity}</td>
                        <td style="text-align: right;">
                            ${itemDiscount > 0 ? `
                                <div style="text-decoration: line-through; color: var(--text-gray); font-size: 0.9em;">
                                    ${utils.formatCurrency(itemPrice)}
                                </div>
                                <div style="color: var(--danger); font-weight: bold;">
                                    ${utils.formatCurrency(finalPrice)}
                                </div>
                            ` : utils.formatCurrency(itemPrice)}
                        </td>
                        <td style="text-align: right;">
                            ${utils.formatCurrency(itemTotal)}
                            ${itemDiscount > 0 ? `<div style="color: var(--success); font-size: 0.9em;">-${utils.formatCurrency(itemDiscountAmount * itemQuantity)}</div>` : ''}
                        </td>
                    </tr>
                `;
            });
            
            const taxSettings = state.settings.tax;
            const taxAmount = subtotal * (taxSettings.percentage || 0) / 100;
            const serviceFeeAmount = subtotal * (taxSettings.serviceFee || 0) / 100;
            const total = subtotal + taxAmount + serviceFeeAmount;
            
            utils.el('orderDetailContent').innerHTML = `
                <div style="background: var(--dark); padding: 20px; border-radius: 10px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                        <div>
                            <h4 style="color: var(--gold);">${utils.t('orderDetails')}</h4>
                            <p><strong>${utils.t('orderId')}:</strong> ${order.orderNumber || orderId}</p>
                            <p><strong>${utils.t('date')}:</strong> ${utils.formatDate(order.timestamp)}</p>
                            <p><strong>${utils.t('status')}:</strong> <span class="status-badge status-${order.status}">${order.status.toUpperCase()}</span></p>
                            <p><strong>${utils.t('method')}:</strong> ${order.method}</p>
                        </div>
                        <div>
                            <h4 style="color: var(--gold);">${utils.t('customer')}</h4>
                            <p><strong>${utils.t('name')}:</strong> ${customer.name}</p>
                            <p><strong>${utils.t('email')}:</strong> ${customer.email}</p>
                            <p><strong>${utils.t('phone')}:</strong> ${customer.phone || '-'}</p>
                        </div>
                    </div>
                    
                    <h4 style="color: var(--gold); margin-bottom: 10px;">${utils.t('orderItems')}</h4>
                    <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                        <thead>
                            <tr style="border-bottom: 1px solid var(--gray);">
                                <th style="text-align: left; padding: 10px;">${utils.t('item')}</th>
                                <th style="text-align: center; padding: 10px;">${utils.t('quantity')}</th>
                                <th style="text-align: right; padding: 10px;">${utils.t('price')}</th>
                                <th style="text-align: right; padding: 10px;">${utils.t('total')}</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${itemsHTML}
                        </tbody>
                    </table>
                    
                    <div style="border-top: 2px solid var(--gold); padding-top: 15px;">
                        <div style="display: flex; justify-content: space-between;">
                            <span>${utils.t('subtotal')}:</span>
                            <span>${utils.formatCurrency(subtotal)}</span>
                        </div>
                        
                        ${totalDiscount > 0 ? `
                            <div style="display: flex; justify-content: space-between; color: var(--success);">
                                <span>${utils.t('totalDiscount')}:</span>
                                <span>-${utils.formatCurrency(totalDiscount)}</span>
                            </div>
                        ` : ''}
                        
                        <div style="display: flex; justify-content: space-between;">
                            <span>${taxSettings.name || 'Tax'} (${taxSettings.percentage || 0}%):</span>
                            <span>${utils.formatCurrency(taxAmount)}</span>
                        </div>
                        
                        <div style="display: flex; justify-content: space-between;">
                            <span>${taxSettings.serviceName || 'Service Charge'} (${taxSettings.serviceFee || 0}%):</span>
                            <span>${utils.formatCurrency(serviceFeeAmount)}</span>
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; font-size: 1.2em; font-weight: bold; margin-top: 10px;">
                            <span>${utils.t('total')}:</span>
                            <span>${utils.formatCurrency(total)}</span>
                        </div>
                    </div>
                    
                    ${order.paymentProof ? `
                        <div style="margin-top: 20px;">
                            <h4 style="color: var(--gold);">${utils.t('paymentProof')}</h4>
                            <p><a href="${order.paymentProof}" target="_blank">${utils.t('viewProof')}</a></p>
                        </div>
                    ` : ''}
                </div>
            `;
            
            // Generate invoice preview
            const invoiceHTML = utils.generateInvoiceHTML(order, state.settings);
            utils.el('invoicePreview').innerHTML = invoiceHTML;
            utils.el('invoicePreview').style.display = 'block';
            
            utils.el('orderDetailModal').style.display = 'flex';
            
        } catch (error) {
            console.error('View order details error:', error);
            utils.showNotification(utils.t('loadOrderDetailsFailed'), 'error');
        }
    },
    
    async printInvoice() {
        const invoiceContent = utils.el('invoicePreview').innerHTML;
        const printWindow = window.open('', '_blank');
        printWindow.document.write(`
            <html>
                <head>
                    <title>Invoice - Grand Bistro</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; }
                        @media print {
                            body { margin: 0; }
                            .no-print { display: none; }
                        }
                    </style>
                </head>
                <body>
                    ${invoiceContent}
                    <div class="no-print" style="margin-top: 20px; text-align: center;">
                        <button onclick="window.print()" style="padding: 10px 20px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            ${utils.t('printInvoice')}
                        </button>
                        <button onclick="window.close()" style="padding: 10px 20px; background: #f44336; color: white; border: none; border-radius: 5px; cursor: pointer; margin-left: 10px;">
                            ${utils.t('close')}
                        </button>
                    </div>
                </body>
            </html>
        `);
        printWindow.document.close();
    },
    
    async sendInvoiceEmail() {
        if (!state.currentOrderId) return;
        
        const loading = utils.showLoading();
        
        try {
            await this.sendInvoice(state.currentOrderId);
            utils.showNotification(utils.t('invoiceSent'), 'success');
        } catch (error) {
            console.error('Send invoice email error:', error);
            utils.showNotification(utils.t('sendInvoiceFailed'), 'error');
        } finally {
            utils.hideLoading(loading);
        }
    },
    
    async generateReport(startDate, endDate, format) {
        try {
            const snapshot = await state.db.collection('orders')
                .where('timestamp', '>=', startDate)
                .where('timestamp', '<=', endDate)
                .get();
            
            const orders = [];
            let totalRevenue = 0;
            let totalOrders = 0;
            let paidOrders = 0;
            let pendingOrders = 0;
            let totalDiscount = 0;
            let totalTax = 0;
            let totalService = 0;
            
            snapshot.forEach(doc => {
                const order = doc.data();
                const orderDate = order.timestamp.toDate ? order.timestamp.toDate() : new Date(order.timestamp);
                
                // Calculate item details
                let subtotal = 0;
                let orderDiscount = 0;
                let orderTax = 0;
                let orderService = 0;
                
                if (order.items) {
                    order.items.forEach(item => {
                        const itemPrice = item.price || 0;
                        const itemQuantity = item.quantity || 1;
                        const itemDiscount = item.discount || 0;
                        const discountType = item.discountType || 'percentage';
                        
                        let finalPrice = itemPrice;
                        let itemDiscountAmount = 0;
                        
                        if (itemDiscount > 0) {
                            if (discountType === 'percentage') {
                                itemDiscountAmount = itemPrice * itemDiscount / 100;
                            } else {
                                itemDiscountAmount = itemDiscount;
                            }
                            finalPrice = itemPrice - itemDiscountAmount;
                        }
                        
                        subtotal += finalPrice * itemQuantity;
                        orderDiscount += itemDiscountAmount * itemQuantity;
                    });
                }
                
                orderTax = subtotal * (state.settings.tax?.percentage || 0) / 100;
                orderService = subtotal * (state.settings.tax?.serviceFee || 0) / 100;
                const orderTotal = subtotal + orderTax + orderService;
                
                orders.push({
                    'Order ID': order.orderNumber || doc.id,
                    'Date': orderDate.toLocaleDateString('id-ID'),
                    'Time': orderDate.toLocaleTimeString('id-ID'),
                    'Customer': order.customer?.name || '',
                    'Email': order.customer?.email || '',
                    'Phone': order.customer?.phone || '',
                    'Method': order.method || '',
                    'Items': order.items?.length || 0,
                    'Subtotal': subtotal,
                    'Discount': orderDiscount,
                    'Tax': orderTax,
                    'Service Fee': orderService,
                    'Total': orderTotal,
                    'Status': order.status || '',
                    'Payment Method': order.paymentMethod || '',
                    'Payment Verified': order.paymentVerified ? 'Yes' : 'No'
                });
                
                totalRevenue += orderTotal;
                totalDiscount += orderDiscount;
                totalTax += orderTax;
                totalService += orderService;
                totalOrders++;
                if (order.status === 'paid') paidOrders++;
                if (order.status === 'pending' || order.status === 'waiting_payment') pendingOrders++;
            });
            
            // Add summary
            const summary = {
                'Order ID': 'SUMMARY REPORT',
                'Date': `${startDate.toLocaleDateString('id-ID')} - ${endDate.toLocaleDateString('id-ID')}`,
                'Time': '',
                'Customer': '',
                'Email': '',
                'Phone': '',
                'Method': '',
                'Items': '',
                'Subtotal': totalRevenue - totalTax - totalService,
                'Discount': totalDiscount,
                'Tax': totalTax,
                'Service Fee': totalService,
                'Total': totalRevenue,
                'Status': `Total: ${totalOrders} | Paid: ${paidOrders} | Pending: ${pendingOrders}`,
                'Payment Method': '',
                'Payment Verified': ''
            };
            
            orders.unshift(summary);
            
            switch(format) {
                case 'csv':
                    this.downloadCSV(orders, `report_${startDate.toISOString().split('T')[0]}_${endDate.toISOString().split('T')[0]}`);
                    break;
                case 'excel':
                    this.downloadExcel(orders, `report_${startDate.toISOString().split('T')[0]}_${endDate.toISOString().split('T')[0]}`);
                    break;
                case 'pdf':
                    this.downloadPDF(orders, `report_${startDate.toISOString().split('T')[0]}_${endDate.toISOString().split('T')[0]}`);
                    break;
            }
            
            utils.showNotification(`Report generated: ${orders.length - 1} orders`, 'success');
            
        } catch (error) {
            console.error('Generate report error:', error);
            utils.showNotification('Gagal generate report', 'error');
        }
    },
    
    downloadCSV(data, filename) {
        if (data.length === 0) {
            utils.showNotification(utils.t('noData'), 'warning');
            return;
        }
        
        const headers = Object.keys(data[0]);
        const csvContent = [
            headers.join(','),
            ...data.map(row => headers.map(header => {
                let cell = row[header] || '';
                if (typeof cell === 'string') {
                    cell = cell.replace(/"/g, '""');
                    if (cell.includes(',') || cell.includes('"') || cell.includes('\n')) {
                        cell = `"${cell}"`;
                    }
                }
                return cell;
            }).join(','))
        ].join('\n');
        
        utils.downloadFile(csvContent, `${filename}.csv`, 'text/csv;charset=utf-8;');
    },
    
    downloadExcel(data, filename) {
        if (data.length === 0) {
            utils.showNotification(utils.t('noData'), 'warning');
            return;
        }
        
        const ws = XLSX.utils.json_to_sheet(data);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, 'Report');
        XLSX.writeFile(wb, `${filename}.xlsx`);
    },
    
    downloadPDF(data, filename) {
        if (data.length === 0) {
            utils.showNotification(utils.t('noData'), 'warning');
            return;
        }
        
        const docDefinition = {
            content: [
                { text: 'GRAND BISTRO - SALES REPORT', style: 'header' },
                { text: `Generated: ${new Date().toLocaleString('id-ID')}`, style: 'subheader' },
                { text: `By: ${state.user.name}`, style: 'subheader' },
                {
                    table: {
                        headerRows: 1,
                        widths: ['auto', 'auto', 'auto', 'auto', 'auto', 'auto', 'auto', 'auto', 'auto', 'auto', 'auto', 'auto', 'auto', 'auto', 'auto'],
                        body: [
                            Object.keys(data[0]),
                            ...data.map(row => Object.values(row))
                        ]
                    },
                    layout: 'lightHorizontalLines'
                }
            ],
            styles: {
                header: {
                    fontSize: 18,
                    bold: true,
                    margin: [0, 0, 0, 10]
                },
                subheader: {
                    fontSize: 12,
                    margin: [0, 0, 0, 10]
                }
            }
        };
        
        pdfMake.createPdf(docDefinition).download(`${filename}.pdf`);
    }
};

// ===== RENDER FUNCTIONS =====
const render = {
    stats() {
        utils.el('incomeToday').textContent = utils.formatCurrency(state.stats.today || 0);
        utils.el('incomeMonth').textContent = utils.formatCurrency(state.stats.month || 0);
        utils.el('totalOrders').textContent = state.stats.total || 0;
        utils.el('pendingPayments').textContent = state.stats.pending || 0;
        utils.el('ordersCount').textContent = `${state.orders.length} ${utils.t('orders')}`;
    },
    
    orders() {
        const container = utils.el('orderList');
        if (!container) return;
        
        const itemsPerPage = 15;
        const startIndex = (state.page - 1) * itemsPerPage;
        const paginatedOrders = state.orders.slice(startIndex, startIndex + itemsPerPage);
        
        if (paginatedOrders.length === 0) {
            container.innerHTML = `
                <tr>
                    <td colspan="8" style="text-align: center; padding: 40px;">
                        <i class="fas fa-inbox" style="font-size: 3rem; color: var(--gray); margin-bottom: 15px; display: block;"></i>
                        <p>${utils.t('noData')}</p>
                    </td>
                </tr>
            `;
            this.renderPagination();
            return;
        }
        
        container.innerHTML = paginatedOrders.map((order, index) => {
            const orderNumber = startIndex + index + 1;
            const statusClass = `status-${order.status || 'pending'}`;
            const customer = order.customer || {};
            
            return `
                <tr>
                    <td>${orderNumber}</td>
                    <td>${utils.formatDate(order.timestamp)}</td>
                    <td>${order.orderNumber || order.id.substring(0, 8)}</td>
                    <td>
                        <div><strong>${customer.name || 'Customer'}</strong></div>
                        <small style="color: var(--text-gray);">${customer.phone || ''}</small>
                    </td>
                    <td>${customer.email || '-'}</td>
                    <td><strong>${utils.formatCurrency(order.total || 0)}</strong></td>
                    <td><span class="status-badge ${statusClass}">${(order.status || 'pending').toUpperCase()}</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="action-btn btn-view" onclick="viewOrderDetails('${order.id}')" title="${utils.t('detail')}">
                                <i class="fas fa-eye"></i> ${utils.t('detail')}
                            </button>
                            ${order.status === 'pending' ? `
                                <button class="action-btn btn-success" onclick="updateStatus('${order.id}', 'paid')" title="${utils.t('approve')}">
                                    <i class="fas fa-check"></i> ${utils.t('paid')}
                                </button>
                            ` : ''}
                            ${order.status === 'waiting_payment' ? `
                                <button class="action-btn btn-upload" onclick="viewPaymentProof('${order.id}')" title="${utils.t('verify')}">
                                    <i class="fas fa-receipt"></i> ${utils.t('verify')}
                                </button>
                            ` : ''}
                            ${order.status !== 'cancelled' ? `
                                <button class="action-btn btn-delete" onclick="updateStatus('${order.id}', 'cancelled')" title="${utils.t('reject')}">
                                    <i class="fas fa-times"></i> ${utils.t('cancel')}
                                </button>
                            ` : ''}
                        </div>
                    </td>
                </tr>
            `;
        }).join('');
        
        this.renderPagination();
    },
    
    recentOrders(orders) {
        const container = utils.el('recentOrders');
        if (!container) return;
        
        if (orders.length === 0) {
            container.innerHTML = `
                <tr>
                    <td colspan="6" style="text-align: center; padding: 20px;">
                        <p>${utils.t('noData')}</p>
                    </td>
                </tr>
            `;
            return;
        }
        
        container.innerHTML = orders.map((order, index) => {
            const statusClass = `status-${order.status || 'pending'}`;
            const customer = order.customer || {};
            
            return `
                <tr>
                    <td>${index + 1}</td>
                    <td>${order.orderNumber || order.id.substring(0, 8)}</td>
                    <td>${customer.name || 'Customer'}</td>
                    <td><strong>${utils.formatCurrency(order.total || 0)}</strong></td>
                    <td><span class="status-badge ${statusClass}">${(order.status || 'pending').toUpperCase()}</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="action-btn btn-view" onclick="viewOrderDetails('${order.id}')" title="${utils.t('view')}">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `;
        }).join('');
    },
    
    pendingPayments(orders) {
        const container = utils.el('pendingPaymentsList');
        if (!container) return;
        
        if (orders.length === 0) {
            container.innerHTML = `
                <tr>
                    <td colspan="5" style="text-align: center; padding: 20px;">
                        <p>${utils.t('noData')}</p>
                    </td>
                </tr>
            `;
            return;
        }
        
        container.innerHTML = orders.map((order) => {
            const customer = order.customer || {};
            
            return `
                <tr>
                    <td>${order.orderNumber || order.id.substring(0, 8)}</td>
                    <td>${customer.name || 'Customer'}</td>
                    <td><strong>${utils.formatCurrency(order.total || 0)}</strong></td>
                    <td>
                        ${order.paymentProof ? `
                            <button class="action-btn btn-view" onclick="viewPaymentProof('${order.id}')" title="${utils.t('view')}">
                                <i class="fas fa-image"></i> ${utils.t('view')}
                            </button>
                        ` : utils.t('noProof')}
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="action-btn btn-success" onclick="updateStatus('${order.id}', 'paid')" title="${utils.t('approve')}">
                                <i class="fas fa-check"></i> ${utils.t('approve')}
                            </button>
                            <button class="action-btn btn-delete" onclick="updateStatus('${order.id}', 'cancelled')" title="${utils.t('reject')}">
                                <i class="fas fa-times"></i> ${utils.t('reject')}
                            </button>
                        </div>
                    </td>
                </tr>
            `;
        }).join('');
    },
    
    renderPagination() {
        const container = utils.el('pagination');
        if (!container) return;
        
        const itemsPerPage = 15;
        const totalPages = Math.ceil(state.orders.length / itemsPerPage);
        
        if (totalPages <= 1) {
            container.innerHTML = '';
            return;
        }
        
        let html = '';
        
        // Previous button
        html += `<button class="page-btn" onclick="goToPage(${Math.max(1, state.page - 1)})" ${state.page === 1 ? 'disabled' : ''}>
                    <i class="fas fa-chevron-left"></i>
                 </button>`;
        
        // Page numbers
        for (let i = 1; i <= totalPages; i++) {
            if (i === 1 || i === totalPages || (i >= state.page - 2 && i <= state.page + 2)) {
                html += `<button class="page-btn ${state.page === i ? 'active' : ''}" onclick="goToPage(${i})">${i}</button>`;
            } else if (i === state.page - 3 || i === state.page + 3) {
                html += `<span class="page-btn">...</span>`;
            }
        }
        
        // Next button
        html += `<button class="page-btn" onclick="goToPage(${Math.min(totalPages, state.page + 1)})" ${state.page === totalPages ? 'disabled' : ''}>
                    <i class="fas fa-chevron-right"></i>
                 </button>`;
        
        container.innerHTML = html;
    },
    
    menu() {
        const container = utils.el('menuList');
        if (!container) return;
        
        if (state.menu.length === 0) {
            container.innerHTML = `
                <div style="grid-column: 1/-1; text-align: center; padding: 40px;">
                    <i class="fas fa-utensils" style="font-size: 3rem; color: var(--gray); margin-bottom: 15px; display: block;"></i>
                    <p>${utils.t('noData')}</p>
                </div>
            `;
            return;
        }
        
        container.innerHTML = state.menu.map(item => {
            const hasDiscount = item.discount && item.discount > 0;
            const discountAmount = hasDiscount ? utils.getDiscountAmount(item.price, item.discount, item.discountType) : 0;
            const finalPrice = hasDiscount ? utils.calculatePriceWithDiscount(item.price, item.discount, item.discountType) : item.price;
            const discountText = hasDiscount ? 
                (item.discountType === 'percentage' ? `${item.discount}%` : `Rp ${item.discount.toLocaleString()}`) : '';
            
            return `
                <div class="menu-item-card">
                    ${hasDiscount ? `<div class="discount-badge">-${discountText}</div>` : ''}
                    <div class="menu-item-image">
                        <img src="${item.image || 'https://via.placeholder.com/300x200?text=No+Image'}" 
                             onerror="this.src='https://via.placeholder.com/300x200?text=No+Image'">
                    </div>
                    <div style="padding: 15px;">
                        <div style="font-weight: 700; color: var(--white); margin-bottom: 5px;">${item.name}</div>
                        <div style="margin-bottom: 5px;">
                            ${hasDiscount ? `
                                <div class="original-price">${utils.formatCurrency(item.price)}</div>
                                <div style="color: var(--gold); font-weight: 900;">
                                    ${utils.formatCurrency(finalPrice)}
                                    <span style="color: var(--danger); font-size: 0.8em; margin-left: 5px;">(-${discountText})</span>
                                </div>
                            ` : `
                                <div style="color: var(--gold); font-weight: 900;">
                                    ${utils.formatCurrency(item.price)}
                                </div>
                            `}
                        </div>
                        <div style="color: var(--text-gray); font-size: 0.85rem; margin-bottom: 10px;">
                            <div>${utils.t('category')}: ${item.category || '-'}</div>
                            <div>${utils.t('stock')}: ${item.stock || 0}</div>
                            <div>${utils.t('cost')}: ${utils.formatCurrency(item.cogs || 0)}</div>
                        </div>
                        <div class="action-buttons">
                            <button class="action-btn btn-edit" onclick="editMenu('${item.id}')" title="${utils.t('edit')}">
                                <i class="fas fa-edit"></i> ${utils.t('edit')}
                            </button>
                            <button class="action-btn btn-delete" onclick="deleteMenuItem('${item.id}')" title="${utils.t('delete')}">
                                <i class="fas fa-trash"></i> ${utils.t('delete')}
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }).join('');
    },
    
    blockedDates(dates) {
        const container = utils.el('blockedDatesList');
        if (!container) return;
        
        if (dates.length === 0) {
            container.innerHTML = `<small style="color: var(--text-gray);">${utils.t('noData')}</small>`;
            return;
        }
        
        const datesHTML = dates.map(date => `
            <div style="padding: 8px 0; border-bottom: 1px solid var(--gray);">
                <div style="font-weight: 600; color: var(--white);">${date.date}</div>
                <small style="color: var(--text-gray);">${date.reason}</small>
                <small style="color: var(--text-gray); display: block;">${utils.t('by')}: ${date.createdBy || 'System'}</small>
            </div>
        `).join('');
        
        container.innerHTML = `
            <div style="color: var(--gold); font-weight: 600; margin-bottom: 10px;">
                ${utils.t('blockedDates')} (${dates.length}):
            </div>
            ${datesHTML}
        `;
    },
    
    bankAccounts() {
        const container = utils.el('bankAccountsList');
        if (!container) return;
        
        if (state.bankAccounts.length === 0) {
            container.innerHTML = `<p style="color: var(--text-gray); text-align: center;">${utils.t('noData')}</p>`;
            return;
        }
        
        container.innerHTML = state.bankAccounts.map(account => `
            <div class="bank-account-item">
                <div>
                    <div style="font-weight: 700; color: var(--white);">${account.bankName}</div>
                    <div style="color: var(--text-gray); font-size: 0.9rem;">${account.accountName}</div>
                    <div style="color: var(--gold); font-weight: 600;">${account.accountNumber}</div>
                </div>
                <button class="action-btn btn-delete" onclick="deleteBankAccount('${account.id}')" title="${utils.t('delete')}">
                    <i class="fas fa-trash"></i> ${utils.t('delete')}
                </button>
            </div>
        `).join('');
    }
};

// ===== CHART =====
const chart = {
    init() {
        const ctx = utils.el('financeChart')?.getContext('2d');
        if (!ctx) return;
        
        if (state.chart) {
            state.chart.destroy();
        }
        
        const labels = [utils.t('monday'), utils.t('tuesday'), utils.t('wednesday'), utils.t('thursday'), utils.t('friday'), utils.t('saturday'), utils.t('sunday')];
        const data = [1500000, 1800000, 2200000, 1900000, 2500000, 3000000, 2800000];
        
        state.chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Revenue',
                    data: data,
                    borderColor: '#d4af37',
                    backgroundColor: 'rgba(212, 175, 55, 0.1)',
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: {
                            color: 'white'
                        }
                    }
                },
                scales: {
                    y: {
                        ticks: {
                            color: 'white',
                            callback: function(value) {
                                return 'Rp ' + value.toLocaleString('id-ID');
                            }
                        },
                        grid: {
                            color: 'rgba(255,255,255,0.1)'
                        }
                    },
                    x: {
                        ticks: {
                            color: 'white'
                        },
                        grid: {
                            color: 'rgba(255,255,255,0.1)'
                        }
                    }
                }
            }
        });
    },
    
    async change(period) {
        document.querySelectorAll('.chart-btn').forEach(b => b.classList.remove('active'));
        event.target.classList.add('active');
        
        utils.showNotification(`Loading ${period} chart data...`, 'info');
        this.init();
    }
};

// ===== AUDIT LOG =====
const log = {
    add(action) {
        const logs = JSON.parse(localStorage.getItem('admin_logs') || '[]');
        logs.unshift({
            timestamp: new Date().toISOString(),
            admin: state.user?.name || 'System',
            action: action
        });
        localStorage.setItem('admin_logs', JSON.stringify(logs.slice(0, 100)));
        this.render();
    },
    
    render() {
        const container = utils.el('logArea');
        if (!container) return;
        
        const logs = JSON.parse(localStorage.getItem('admin_logs') || '[]');
        
        if (logs.length === 0) {
            container.innerHTML = `<small style="color: var(--text-gray);">${utils.t('noData')}</small>`;
            return;
        }
        
        container.innerHTML = logs.map(log => `
            <div style="padding: 8px 0; border-bottom: 1px solid var(--gray);">
                <small style="color: var(--gold);">${utils.formatDate(log.timestamp)}</small>
                <div><b>${log.admin}</b>: ${log.action}</div>
            </div>
        `).join('');
    }
};

// ===== GLOBAL FUNCTIONS =====
function showForm(type) {
    document.querySelectorAll('.login-tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.login-form').forEach(f => f.classList.remove('active'));
    utils.el(type + 'Form').classList.add('active');
    event.target.classList.add('active');
}

function showAdminTab(tabName) {
    // Hide all tabs
    document.querySelectorAll('.admin-tab-content').forEach(tab => {
        tab.style.display = 'none';
    });
    
    // Remove active class from all tab buttons
    document.querySelectorAll('.admin-tab').forEach(btn => {
        btn.classList.remove('active');
    });
    
    // Show selected tab
    utils.el(tabName + 'Tab').style.display = 'block';
    event.target.classList.add('active');
    
    // Load data for specific tab
    switch(tabName) {
        case 'orders':
            data.loadAllOrders();
            break;
        case 'menu':
            data.loadMenu();
            break;
        case 'payments':
            data.loadPendingPayments();
            data.loadBankAccounts();
            break;
        case 'settings':
            data.loadSettings();
            data.loadBlockedDates();
            break;
    }
}

function showSettingsTab(tabName) {
    // Hide all settings tabs
    document.querySelectorAll('.settings-tab-content').forEach(tab => {
        tab.style.display = 'none';
    });
    
    // Remove active class from all settings tab buttons
    document.querySelectorAll('.settings-tab').forEach(btn => {
        btn.classList.remove('active');
    });
    
    // Show selected settings tab
    utils.el(tabName + 'Settings').style.display = 'block';
    event.target.classList.add('active');
}

function goToPage(page) {
    if (page > 0) {
        state.page = page;
        render.orders();
    }
}

function editMenu(menuId) {
    data.editMenu(menuId);
}

function deleteMenuItem(menuId) {
    data.deleteMenu(menuId);
}

function updateStatus(orderId, status) {
    data.updateOrderStatus(orderId, status);
}

function viewOrderDetails(orderId) {
    data.viewOrderDetails(orderId);
}

function viewPaymentProof(orderId) {
    data.viewPaymentProof(orderId);
}

function verifyPayment(approved) {
    data.verifyPayment(approved);
}

function closeModal(modalId) {
    utils.el(modalId).style.display = 'none';
}

// Close modal when clicking outside
document.querySelectorAll('.modal').forEach(modal => {
    modal.addEventListener('click', function(e) {
        if (e.target === this) {
            this.style.display = 'none';
        }
    });
});

// Report download functions
function downloadReport(period, format) {
    const now = new Date();
    let startDate, endDate;
    
    switch(period) {
        case 'daily':
            startDate = new Date(now);
            startDate.setHours(0, 0, 0, 0);
            endDate = new Date(now);
            endDate.setHours(23, 59, 59, 999);
            break;
            
        case 'weekly':
            startDate = new Date(now);
            startDate.setDate(startDate.getDate() - 7);
            endDate = new Date(now);
            endDate.setHours(23, 59, 59, 999);
            break;
            
        case 'monthly':
            startDate = new Date(now.getFullYear(), now.getMonth(), 1);
            endDate = new Date(now);
            endDate.setHours(23, 59, 59, 999);
            break;
            
        case 'custom':
            utils.el('customReportRange').style.display = 'block';
            return;
    }
    
    data.generateReport(startDate, endDate, format);
}

function generateCustomReport(format) {
    const startDateStr = utils.el('reportStartDate').value;
    const endDateStr = utils.el('reportEndDate').value;
    
    if (!startDateStr || !endDateStr) {
        utils.showNotification(utils.t('selectDateRange'), 'error');
        return;
    }
    
    const startDate = new Date(startDateStr);
    startDate.setHours(0, 0, 0, 0);
    
    const endDate = new Date(endDateStr);
    endDate.setHours(23, 59, 59, 999);
    
    if (startDate > endDate) {
        utils.showNotification(utils.t('invalidDateRange'), 'error');
        return;
    }
    
    data.generateReport(startDate, endDate, format);
}

function searchMenuItems() {
    const searchTerm = utils.el('searchMenu').value.toLowerCase();
    const menuItems = document.querySelectorAll('.menu-item-card');
    
    menuItems.forEach(item => {
        const name = item.querySelector('div[style*="font-weight: 700"]').textContent.toLowerCase();
        if (name.includes(searchTerm)) {
            item.style.display = 'block';
        } else {
            item.style.display = 'none';
        }
    });
}

function printInvoice() {
    data.printInvoice();
}

function sendInvoiceEmail() {
    data.sendInvoiceEmail();
}

function updateInvoicePreview() {
    utils.showNotification(utils.t('previewUpdated'), 'success');
}

function loadOrders() { data.loadAllOrders(); }
function resetFilter() { 
    utils.el('filterDate').value = ''; 
    utils.el('filterStatus').value = 'all'; 
    data.loadAllOrders(); 
}
function changeChart(period) { chart.change(period); }
function saveMenu() { data.saveMenu(); }
function blockDateAction() { data.blockDateAction(); }
function addBankAccount() { data.addBankAccount(); }
function deleteBankAccount(accountId) { data.deleteBankAccount(accountId); }
function saveGeneralSettings() { data.saveGeneralSettings(); }
function saveTaxSettings() { data.saveTaxSettings(); }
function saveInvoiceSettings() { data.saveInvoiceSettings(); }
function logout() { auth.logout(); }

// Language functions (expose to window)
window.setLanguage = setLanguage;
window.getTranslation = getTranslation;
window.updateUIText = updateUIText;

// ===== INITIALIZATION =====
document.addEventListener('DOMContentLoaded', () => {
    auth.init();
});
</script>
</body>
</html>